!function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){var i=t[o][1][e];return r(i?i:e)},h,h.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t){var n=(e("./VRScene.js"),e("./VRUINumberSlider.js")),r=e("./VRUIAccordionStacker.js"),s=(e("./VRSceneDict.js"),e("./VRUISceneList.js")),o=e("./VRStoryDict.js"),a=e("./VRImageLoader.js"),c={},l=function(e,t){var n=null,r=e.split("/");for(i=0;i<r.length;i++)if("photos"==r[i]&&i+2<r.length){n=r[i+2];break}if(null==n)return!1;if(n in c)return void t(c[n]);var s="";s+="https://api.flickr.com/services/rest/?",s+="&method=flickr.photos.getSizes",s+="&api_key=c074e17f92ea52a8d9422928352b0053",s+="&photo_id="+n,s+="&format=json",s+="&nojsoncallback=1";var o=new XMLHttpRequest;o.open("GET",s,!0),o.send(),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(o.responseText),r=e.sizes.size,s=0,a=0;for(i=0;i<r.length;i++){var l=parseInt(r[i].width);2048>=l&&l>a&&(a=l,s=i)}c[n]=r[s].source,t(c[n])}}};VRCreateUI=function(){var e=this;this.firstRun=!0,this.storyManager=null,this.photoIdx=0,this.sceneIdx=0,this.sceneList=new s,this.sceneSelect=null,this.sceneName=null,this.elementSelect=null,this.imageURL=null,this.imagePreviewCanvas=null,this.hfovVRUINumberSlider=null,this.vfovVRUINumberSlider=null,this.xposVRUINumberSlider=null,this.yposVRUINumberSlider=null,this.isPlane=null,this.isStereo=null,this.U_l_x_slider=null,this.U_l_y_slider=null,this.V_l_x_slider=null,this.V_l_y_slider=null,this.U_r_x_slider=null,this.U_r_y_slider=null,this.V_r_x_slider=null,this.V_r_y_slider=null,this.textMessage=null,this.sceneJump=null,this.fontAlign=null,this.fontFace=null,this.fontSize=null,this.borderThickness=null,this.borderColor=null,this.backgroundColor=null,this.textColor=null,this.accordionStacker=null,this.oneImage=null,this.modeOneImage=null,this.modeNewStory=null,this.existingStory=null,this.modeExistingStory=null,this.oneImageMode="single",this.exportEquirectangularButton=null,this.getStory=function(){return e.storyManager.storyList!=[]?this.storyManager.storyList[0]:null},this.setPanelVisibility=function(){if(""==e.elementSelect.value)return e.showImageOptions(!1),e.showOptionsPosition(!1),e.showOptionsPosition3D(!1),e.showOptionsPlanar(!1),e.showOptionsText(!1),e.showOptionsJump(!1),void e.showOptionsTextCommon(!1);var t=e.elementSelect.value.split("_"),i=t[0];"photo"==i?(e.showImageOptions(!0),e.showOptionsPosition(!0),e.showOptionsPosition3D(!0),e.showOptionsPlanar(e.isPlane.checked),e.showStereoOptions(e.isStereo.checked),e.showOptionsText(!1),e.showOptionsJump(!1),e.showOptionsTextCommon(!1)):"text"==i?(e.showImageOptions(!1),e.showOptionsPosition(!0),e.showOptionsPosition3D(!1),e.showOptionsPlanar(e.isPlane.checked),e.showOptionsText(!0),e.showOptionsJump(!0),e.showOptionsTextCommon(!0)):"decal"==i&&(e.showImageOptions(!0),e.showOptionsPosition(!0),e.showOptionsPosition3D(!1),e.showOptionsPlanar(e.isPlane.checked),e.showStereoOptions(!1),e.showOptionsText(!1),e.showOptionsJump(!0),e.showOptionsTextCommon(!1))},this.showImageOptions=function(e){document.getElementById("options_image_load").hidden=!e},this.showOptionsPosition=function(e){document.getElementById("options_position").hidden=!e},this.showOptionsPosition3D=function(e){document.getElementById("options_position_3d").hidden=!e},this.showOptionsPlanar=function(e){document.getElementById("options_planar").hidden=!e},this.showOptionsText=function(e){document.getElementById("options_text").hidden=!e},this.showOptionsJump=function(e){document.getElementById("options_jump").hidden=!e},this.showOptionsTextCommon=function(e){document.getElementById("options_text_common").hidden=!e},this.showStereoOptions=function(e){var t=document.getElementById("options_stereo");t.hidden=e?!1:!0},this.inputStateChange=function(){if(""!=e.elementSelect.value){var t=e.elementSelect.value.split("_"),i=t[0],n=t[1],r=e.sceneList.scenes[e.sceneSelect.value];if("photo"==i){var s=r.dict.photoObjects[n],o=parseFloat(e.hfovVRUINumberSlider.get()),a=parseFloat(e.vfovVRUINumberSlider.get()),c=parseFloat(e.xposVRUINumberSlider.get()),h=parseFloat(e.yposVRUINumberSlider.get()),u=parseFloat(e.planarOffsetXSlider.get()),p=parseFloat(e.planarOffsetYSlider.get());s.textureDescription.sphereFOV[0]=o,s.textureDescription.sphereFOV[1]=a,s.textureDescription.sphereCentre[0]=c,s.textureDescription.sphereCentre[1]=h,s.textureDescription.src=e.imageURL.value,s.textureDescription.plane=e.isPlane.checked,s.textureDescription.isStereo=e.isStereo.checked,s.textureDescription.planeOffset=[u,p],s.textureDescription.U_l=[parseFloat(e.U_l_x_slider.get()),parseFloat(e.U_l_y_slider.get())],s.textureDescription.V_l=[parseFloat(e.V_l_x_slider.get()),parseFloat(e.V_l_y_slider.get())],s.textureDescription.U_r=[parseFloat(e.U_r_x_slider.get()),parseFloat(e.U_r_y_slider.get())],s.textureDescription.V_r=[parseFloat(e.V_r_x_slider.get()),parseFloat(e.V_r_y_slider.get())]}else if("text"==i){var d=r.dict.textObjects[n],o=parseFloat(e.hfovVRUINumberSlider.get()),a=parseFloat(e.vfovVRUINumberSlider.get()),c=parseFloat(e.xposVRUINumberSlider.get()),h=parseFloat(e.yposVRUINumberSlider.get()),u=parseFloat(e.planarOffsetXSlider.get()),p=parseFloat(e.planarOffsetYSlider.get());d.textureDescription.sphereFOV[0]=o,d.textureDescription.sphereFOV[1]=a,d.textureDescription.sphereCentre[0]=c,d.textureDescription.sphereCentre[1]=h,d.textureDescription.plane=e.isPlane.checked,d.textureDescription.planeOffset=[u,p],d.message=e.textMessage.value,d.jumpTo=e.sceneJump.value,d.textOptions.align=e.fontAlign.value,d.textOptions.fontface=e.fontFace.value,d.textOptions.fontsize=e.fontSize.value,d.textOptions.borderthickness=e.borderThickness.value,d.textOptions.bordercolor=e.borderColor.value,d.textOptions.backgroundcolor=e.backgroundColor.value,d.textOptions.textcolor=e.textColor.value}else if("decal"==i){var m=r.dict.decalObjects[n],o=parseFloat(e.hfovVRUINumberSlider.get()),a=parseFloat(e.vfovVRUINumberSlider.get()),c=parseFloat(e.xposVRUINumberSlider.get()),h=parseFloat(e.yposVRUINumberSlider.get()),u=parseFloat(e.planarOffsetXSlider.get()),p=parseFloat(e.planarOffsetYSlider.get());m.textureDescription.sphereFOV[0]=o,m.textureDescription.sphereFOV[1]=a,m.textureDescription.sphereCentre[0]=c,m.textureDescription.sphereCentre[1]=h,m.textureDescription.plane=e.isPlane.checked,m.textureDescription.planeOffset=[u,p],m.imgsrc=e.imageURL.value,m.jumpTo=e.sceneJump.value}if(e.setPanelVisibility(),"photo"==i){var g=e.imageURL.value;if(-1!=g.indexOf("flickr.com/photos"))return void l(g,e.deferredImageUpdate);e.updateImagePreview()}e.pushFromDictToRender()}},this.deferredImageUpdate=function(t){var i=e.elementSelect.value.split("_"),n=(i[0],i[1]),r=e.sceneList.scenes[e.sceneSelect.value],s=r.dict.photoObjects[n];s.textureDescription.src=t,e.imagePreview.src=t,e.updateImagePreview(),e.pushFromDictToRender()},this.updateImagePreview=function(){var t=1024,i=e.imagePreviewCanvas.getContext("2d");i.clearRect(0,0,t,t);var n,r,s,o,a=i.canvas.clientWidth,c=i.canvas.clientHeight,l=e.imagePreview.width,h=e.imagePreview.height,u=a/c,p=l/h;if(p>u?(s=t,o=s*u):u>1&&p>1?(o=t,s=o/u):u>p?(o=t,s=o/u):(s=t,o=s*u),n=.5*t-.5*s,r=.5*t-.5*o,e.isStereo.checked){i.globalAlpha=.5,i.drawImage(e.imagePreview,n,r,s,o),i.globalAlpha=1,i.strokeStyle="rgba(0,0,0,1.0)",i.fillStyle=i.strokeStyle,i.lineWidth=4,i.moveTo(n,r),i.lineTo(n+s,r),i.moveTo(n,r+.5*o),i.lineTo(n+s,r+.5*o),i.moveTo(n,r+o),i.lineTo(n+s,r+o),i.moveTo(n,r),i.lineTo(n,r+o),i.moveTo(n+.5*s,r),i.lineTo(n+.5*s,r+o),i.moveTo(n+s,r),i.lineTo(n+s,r+o),i.stroke(),i.font="32px Arial",i.fillText("(0,0)",n,r+32),i.fillText("(0,0.5)",n,r+.5*o-32),i.fillText("(0,1)",n,r+o-32),i.fillText("(0.5,0)",n+.5*s-96,r+32),i.fillText("(0.5,0.5)",n+.5*s-116,r+.5*o-32),i.fillText("(0.5,1)",n+.5*s-96,r+o-32),i.fillText("(1,0)",n+s-72,r+32),i.fillText("(1,0.5)",n+s-96,r+.5*o-32),i.fillText("(1,1)",n+s-72,r+o-32),i.lineWidth=1,i.font="Bold 64px Arial";var d=[parseFloat(e.U_l_x_slider.get()),parseFloat(e.U_l_y_slider.get())],m=[parseFloat(e.V_l_x_slider.get()),parseFloat(e.V_l_y_slider.get())];U=[n+d[0]*s,r+d[1]*o],V=[n+m[0]*s,r+m[1]*o],i.fillStyle="rgba(255,0,0,0.5)",i.strokeStyle="rgba(255,0,0,0.5)",i.fillRect(U[0],U[1],V[0]-U[0],V[1]-U[1]),i.stroke(),i.fillStyle="rgba(255,0,0,1.0)",i.strokeStyle="rgba(255,0,0,1.0)",i.fillText("Left",U[0],U[1]+64);var g=[parseFloat(e.U_r_x_slider.get()),parseFloat(e.U_r_y_slider.get())],f=[parseFloat(e.V_r_x_slider.get()),parseFloat(e.V_r_y_slider.get())];U=[n+g[0]*s,r+g[1]*o],V=[n+f[0]*s,r+f[1]*o],i.fillStyle="rgba(0,0,255,0.5)",i.strokeStyle="rgba(0,0,255,0.5)",i.fillRect(U[0],U[1],V[0]-U[0],V[1]-U[1]),i.stroke(),i.fillStyle="rgba(0,0,255,1.0)",i.strokeStyle="rgba(0,0,255,1.0)",i.fillText("Right",U[0],U[1]+64)}else i.drawImage(e.imagePreview,n,r,s,o)},this.loadImage=function(){e.imagePreview.onload=e.updateImagePreview,e.inputStateChange();var t=e.imageURL.value;e.imagePreview.src=t},this.updateSceneListDropdown=function(){for(e.sceneSelect.innerHTML="",i=0;i<e.sceneList.scenes.length;i++){var t=e.sceneList.scenes[i],n=document.createElement("option");n.value=i,n.innerHTML=""!=t.dict.name?t.dict.name:i,e.sceneSelect.appendChild(n)}},this.populateGUIFromSceneDict=function(t){e.sceneSelect.value=t,e.elementSelect.innerHTML="";var n=e.sceneList.scenes[t];for(this.sceneName.value=n.dict.name,i=0;i<n.dict.photoObjects.length;i++){var r=document.createElement("option");r.value="photo_"+i,r.innerHTML="Image "+(i+1),e.elementSelect.appendChild(r)}for(i=0;i<n.dict.textObjects.length;i++){var r=document.createElement("option");r.value="text_"+i,r.innerHTML="Text "+(i+1),e.elementSelect.appendChild(r)}for(i=0;i<n.dict.decalObjects.length;i++){var r=document.createElement("option");r.value="decal_"+i,r.innerHTML="Decal "+(i+1),e.elementSelect.appendChild(r)}e.pushFromDictToRender()},this.pushFromGUIToDict=function(){e.sceneList.scenes[e.sceneSelect.value].dict.name=e.sceneName.value,e.updateSceneListDropdown(),e.pushFromDictToRender()},this.addImage=function(){var t=e.sceneList.scenes[e.sceneSelect.value];t.addPhoto(),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="photo_"+(t.dict.photoObjects.length-1),e.selectElement(),e.accordionStacker.showNamed("setup_scene_object")},this.addText=function(){var t=e.sceneList.scenes[e.sceneSelect.value];t.addText(),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="text_"+(t.dict.textObjects.length-1),e.selectElement(),e.accordionStacker.showNamed("setup_scene_object")},this.addDecal=function(){var t=e.sceneList.scenes[e.sceneSelect.value];t.addDecal(),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="decal_"+(t.dict.decalObjects.length-1),e.selectElement(),e.accordionStacker.showNamed("setup_scene_object")},this.removeElement=function(){if(""!=e.elementSelect.value){var t=e.elementSelect.value.split("_"),i=t[0],n=t[1],r=e.sceneList.scenes[e.sceneSelect.value];"photo"==i?r.removePhoto(n):"text"==i?r.removeText(n):"decal"==i&&r.removeDecal(n),e.populateGUIFromSceneDict(e.sceneSelect.value)}},this.pushFromDictToRender=function(){if(null!=e.getStory()){for(e.getStory().sceneList=[],i=0;i<e.sceneList.scenes.length;i++)e.getStory().sceneList.push(e.sceneList.scenes[i].vrScene);var t=e.sceneList.scenes[e.sceneSelect.value];e.getStory().sceneList[e.sceneSelect.value].initDict(t.dict),e.getStory().setupScene(e.sceneSelect.value),e.updateShare()}},this.selectElement=function(){if(e.setPanelVisibility(),""!=e.elementSelect.value){var t=e.elementSelect.value.split("_"),i=t[0],n=t[1],r=e.sceneList.scenes[e.sceneSelect.value];if("photo"==i){var s=r.dict.photoObjects[n];e.hfovVRUINumberSlider.set(s.textureDescription.sphereFOV[0]),e.vfovVRUINumberSlider.set(s.textureDescription.sphereFOV[1]),e.xposVRUINumberSlider.set(s.textureDescription.sphereCentre[0]),e.yposVRUINumberSlider.set(s.textureDescription.sphereCentre[1]),e.imageURL.value=s.textureDescription.src,e.isPlane.checked=s.textureDescription.plane,e.isStereo.checked=s.textureDescription.isStereo,e.U_l_x_slider.set(s.textureDescription.U_l[0]),e.U_l_y_slider.set(s.textureDescription.U_l[1]),e.V_l_x_slider.set(s.textureDescription.V_l[0]),e.V_l_y_slider.set(s.textureDescription.V_l[1]),e.U_r_x_slider.set(s.textureDescription.U_r[0]),e.U_r_y_slider.set(s.textureDescription.U_r[1]),e.V_r_x_slider.set(s.textureDescription.V_r[0]),e.V_r_y_slider.set(s.textureDescription.V_r[1]),e.planarOffsetXSlider.set(s.textureDescription.planeOffset[0]),e.planarOffsetYSlider.set(s.textureDescription.planeOffset[1]),e.loadImage()}else if("text"==i){var o=r.dict.textObjects[n];e.hfovVRUINumberSlider.set(o.textureDescription.sphereFOV[0]),e.vfovVRUINumberSlider.set(o.textureDescription.sphereFOV[1]),e.xposVRUINumberSlider.set(o.textureDescription.sphereCentre[0]),e.yposVRUINumberSlider.set(o.textureDescription.sphereCentre[1]),e.planarOffsetXSlider.set(o.textureDescription.planeOffset[0]),e.planarOffsetYSlider.set(o.textureDescription.planeOffset[1]),e.isPlane.checked=o.textureDescription.plane,e.textMessage.value=o.message,e.sceneJump.value=o.jumpTo,e.fontAlign.value=o.textOptions.align,e.fontFace.value=o.textOptions.fontface,e.fontSize.value=o.textOptions.fontsize,e.borderThickness.value=o.textOptions.borderthickness,e.borderColor.value=o.textOptions.bordercolor,e.backgroundColor.value=o.textOptions.backgroundcolor,e.textColor.value=o.textOptions.textcolor}else if("decal"==i){var a=r.dict.decalObjects[n];e.hfovVRUINumberSlider.set(a.textureDescription.sphereFOV[0]),e.vfovVRUINumberSlider.set(a.textureDescription.sphereFOV[1]),e.xposVRUINumberSlider.set(a.textureDescription.sphereCentre[0]),e.yposVRUINumberSlider.set(a.textureDescription.sphereCentre[1]),e.isPlane.checked=a.textureDescription.plane,e.planarOffsetXSlider.set(a.textureDescription.planeOffset[0]),e.planarOffsetYSlider.set(a.textureDescription.planeOffset[1]),e.imageURL.value=a.imgsrc,e.sceneJump.value=a.jumpTo}}},this.sceneSelectChange=function(){e.populateGUIFromSceneDict(e.sceneSelect.value),e.selectElement()},this.addScene=function(){e.sceneList.addScene(),e.updateSceneListDropdown(),e.populateGUIFromSceneDict(e.sceneSelect.length-1)},this.removeScene=function(){e.sceneList.removeScene(),e.updateSceneListDropdown()},this.stackerEditGallery=function(){e.accordionStacker.totalHide("mode_pick",!0),e.accordionStacker.totalHide("manage_scenes",!0),e.accordionStacker.totalHide("manage_scene_objects",!0),e.accordionStacker.totalHide("setup_scene_object",!0),e.accordionStacker.totalHide("preview_dummy",!0),e.accordionStacker.totalHide("export",!1),e.accordionStacker.showNamed("export"),document.getElementById("preview_box").hidden=!0},this.stackerEditQuick=function(){e.accordionStacker.totalHide("mode_pick",!0),e.accordionStacker.totalHide("manage_scenes",!0),e.accordionStacker.totalHide("manage_scene_objects",!0),e.accordionStacker.totalHide("setup_scene_object",!1),e.accordionStacker.totalHide("preview_dummy",!1),e.accordionStacker.totalHide("export",!1),e.accordionStacker.showNamed("setup_scene_object"),document.getElementById("preview_box").hidden=!1},this.stackerEditFull=function(){e.accordionStacker.totalHide("mode_pick",!0),e.accordionStacker.totalHide("manage_scenes",!1),e.accordionStacker.totalHide("manage_scene_objects",!1),e.accordionStacker.totalHide("setup_scene_object",!1),e.accordionStacker.totalHide("preview_dummy",!1),e.accordionStacker.totalHide("export",!1),e.accordionStacker.showNamed("manage_scenes"),document.getElementById("preview_box").hidden=!1},this.stackerInit=function(){e.accordionStacker.totalHide("manage_scenes",!0),e.accordionStacker.totalHide("manage_scene_objects",!0),e.accordionStacker.totalHide("setup_scene_object",!0),e.accordionStacker.totalHide("preview_dummy",!0),e.accordionStacker.totalHide("export",!0),document.getElementById("preview_box").hidden=!0},this.tryModeOneImage=function(){if(""!=e.oneImage.value){e.oneImageMode="single";var t=e.oneImage.value;-1!=t.indexOf("flickr.com/photos")?l(t,e.loadModeOneImage):e.loadModeOneImage(t)}},this.tryMode360Image=function(){if(""!=e.oneImage.value){e.oneImageMode="360";var t=e.oneImage.value;-1!=t.indexOf("flickr.com/photos")?l(t,e.loadModeOneImage):e.loadModeOneImage(t)}},this.tryModeStereoImage=function(){if(""!=e.oneImage.value){e.oneImageMode="stereo";var t=e.oneImage.value;-1!=t.indexOf("flickr.com/photos")?l(t,e.loadModeOneImage):e.loadModeOneImage(t)}},this.tryModeGallery=function(){if(""!=e.oneImage.value){var t=e.oneImage.value;a.getImagesCallback(t,e.loadGallery),e.getStory().setGallerySrc(t)}},this.loadGallery=function(t){e.sceneSelect.value=0,e.sceneList.scenes=t,e.populateGUIFromSceneDict(e.sceneSelect.value),e.selectElement(),e.stackerEditGallery()},this.loadModeOneImage=function(t){var i=e.sceneList.scenes[e.sceneSelect.value];i.addPhoto(),i.dict.photoObjects[0].textureDescription.src=t,"360"==e.oneImageMode?i.dict.photoObjects[0].textureDescription.sphereFOV=[360,180]:"stereo"==e.oneImageMode&&(i.dict.photoObjects[0].textureDescription.isStereo=!0),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="photo_"+(i.dict.photoObjects.length-1),e.selectElement(),e.stackerEditQuick()},this.tryModeNewStory=function(){e.stackerEditFull()},this.tryModeExistingStory=function(){if(""!=e.existingStory.value){var t=e.existingStory.value,i=new o,n=i.init(t);null!=n&&(e.sceneList.scenes=n,e.sceneList.sceneIdx=0,e.updateSceneListDropdown(),e.populateGUIFromSceneDict(0),e.stackerEditFull())}},this.updateShare=function(){var t=e.getStory().getShareCodes(),i=t[0],n=t[1];if(e.getStory().isSinglePhotoStory()){document.getElementById("singleShare").hidden=!1;var r="https://twitter.com/intent/tweet?text="+encodeURIComponent("Check out my #vrEmbed ")+i,s="https://www.facebook.com/sharer/sharer.php?u="+i,o="https://plus.google.com/share?url="+i,a="http://www.reddit.com/submit?url="+i;document.getElementById("shareURL").href=decodeURIComponent(i),document.getElementById("shareTwitter").href=r,document.getElementById("shareFacebook").href=s,document.getElementById("shareGplus").href=o,document.getElementById("shareReddit").href=a}else document.getElementById("singleShare").hidden=!0;document.getElementById("shareEmbedCode").value=n},this.downloadURI=function(e,t){var i=document.createElement("a");i.download=t,i.href=e,i.click()},this.exportEquirectangular=function(){var t=e.getStory().createImageFromSphereTexture();e.downloadURI(t,"exportEquirectangularTex.png")},this.initObjectPanel=function(){this.imageURL=document.getElementById("imageURL"),this.imagePreviewCanvas=document.getElementById("imagePreviewCanvas");var t=e.imagePreviewCanvas.getContext("2d");t.canvas.width=1024,t.canvas.height=1024,this.imagePreview=new Image,this.imagePreview.crossOrigin="Anonymous",this.imageURL.onchange=this.loadImage,this.imageURL.value="",this.isPlane=document.getElementById("isPlane"),this.isStereo=document.getElementById("isStereo"),this.isPlane.onchange=this.inputStateChange,this.isStereo.onchange=this.inputStateChange,this.U_l_x_slider=new n,this.U_l_x_slider.init(document.getElementById("U_l_x"),document.getElementById("U_l_x_t"),0,this.inputStateChange),this.U_l_y_slider=new n,this.U_l_y_slider.init(document.getElementById("U_l_y"),document.getElementById("U_l_y_t"),0,this.inputStateChange),this.V_l_x_slider=new n,this.V_l_x_slider.init(document.getElementById("V_l_x"),document.getElementById("V_l_x_t"),0,this.inputStateChange),this.V_l_y_slider=new n,this.V_l_y_slider.init(document.getElementById("V_l_y"),document.getElementById("V_l_y_t"),0,this.inputStateChange),this.U_r_x_slider=new n,this.U_r_x_slider.init(document.getElementById("U_r_x"),document.getElementById("U_r_x_t"),0,this.inputStateChange),this.U_r_y_slider=new n,this.U_r_y_slider.init(document.getElementById("U_r_y"),document.getElementById("U_r_y_t"),0,this.inputStateChange),this.V_r_x_slider=new n,this.V_r_x_slider.init(document.getElementById("V_r_x"),document.getElementById("V_r_x_t"),0,this.inputStateChange),this.V_r_y_slider=new n,this.V_r_y_slider.init(document.getElementById("V_r_y"),document.getElementById("V_r_y_t"),0,this.inputStateChange);var i=document.getElementById("loadImage");i.onclick=this.loadImage,this.hfovVRUINumberSlider=new n,this.hfovVRUINumberSlider.init(document.getElementById("hfov"),document.getElementById("hfov_t"),360,this.inputStateChange),this.vfovVRUINumberSlider=new n,this.vfovVRUINumberSlider.init(document.getElementById("vfov"),document.getElementById("vfov_t"),180,this.inputStateChange),this.xposVRUINumberSlider=new n,this.xposVRUINumberSlider.init(document.getElementById("xpos"),document.getElementById("xpos_t"),0,this.inputStateChange),this.yposVRUINumberSlider=new n,this.yposVRUINumberSlider.init(document.getElementById("ypos"),document.getElementById("ypos_t"),0,this.inputStateChange),this.planarOffsetXSlider=new n,this.planarOffsetXSlider.init(document.getElementById("planeOffsetX"),document.getElementById("planeOffsetX_t"),0,this.inputStateChange),this.planarOffsetYSlider=new n,this.planarOffsetYSlider.init(document.getElementById("planeOffsetY"),document.getElementById("planeOffsetY_t"),0,this.inputStateChange),this.textMessage=document.getElementById("textMessage"),this.textMessage.onchange=this.inputStateChange,this.sceneJump=document.getElementById("sceneJump"),this.sceneJump.onchange=this.inputStateChange,this.fontAlign=document.getElementById("fontAlign"),this.fontAlign.onchange=this.inputStateChange,this.fontFace=document.getElementById("fontFace"),this.fontFace.onchange=this.inputStateChange,this.fontSize=document.getElementById("fontSize"),this.fontSize.onchange=this.inputStateChange,this.borderThickness=document.getElementById("borderThickness"),this.borderThickness.onchange=this.inputStateChange,this.borderColor=document.getElementById("borderColor"),this.borderColor.onchange=this.inputStateChange,this.backgroundColor=document.getElementById("backgroundColor"),this.backgroundColor.onchange=this.inputStateChange,this.textColor=document.getElementById("textColor"),this.textColor.onchange=this.inputStateChange},this.init=function(e){this.storyManager=e,this.sceneSelect=document.getElementById("sceneSelect"),this.sceneName=document.getElementById("sceneName"),this.elementSelect=document.getElementById("elementSelect");var t=document.getElementById("addScene");t.onclick=this.addScene;var i=document.getElementById("removeScene");i.onclick=this.removeScene,this.sceneSelect.onchange=this.sceneSelectChange,this.sceneName.onchange=this.pushFromGUIToDict,this.elementSelect.onchange=this.selectElement;var n=document.getElementById("addImage"),s=document.getElementById("addText"),o=document.getElementById("addDecal"),a=document.getElementById("removeElement");n.onclick=this.addImage,s.onclick=this.addText,o.onclick=this.addDecal,a.onclick=this.removeElement,this.oneImage=document.getElementById("oneImage"),this.modeOneImage=document.getElementById("modeOneImage"),this.mode360Image=document.getElementById("mode360Image"),this.modeStereoImage=document.getElementById("modeStereoImage"),this.modeGallery=document.getElementById("modeGallery"),this.modeNewStory=document.getElementById("modeNewStory"),this.existingStory=document.getElementById("existingStory"),this.modeExistingStory=document.getElementById("modeExistingStory"),modeOneImage.onclick=this.tryModeOneImage,mode360Image.onclick=this.tryMode360Image,modeStereoImage.onclick=this.tryModeStereoImage,modeGallery.onclick=this.tryModeGallery,modeNewStory.onclick=this.tryModeNewStory,modeExistingStory.onclick=this.tryModeExistingStory,this.oneImage.value="http://vrembed.org/src/assets/vrEmbedLogo.png",this.exportEquirectangularButton=document.getElementById("exportEquirectangularButton"),this.exportEquirectangularButton.onclick=this.exportEquirectangular,this.initObjectPanel(),this.sceneList.init(),this.updateSceneListDropdown(),this.sceneSelect.value=0,this.sceneSelectChange(),this.setPanelVisibility(),this.accordionStacker=new r,this.accordionStacker.add("mode_pick"),this.accordionStacker.add("manage_scenes"),this.accordionStacker.add("manage_scene_objects"),this.accordionStacker.add("setup_scene_object"),this.accordionStacker.add("preview_dummy"),this.accordionStacker.add("export"),this.accordionStacker.showNamed("mode_pick"),this.stackerInit()}},t.exports=VRCreateUI},{"./VRImageLoader.js":3,"./VRScene.js":5,"./VRSceneDict.js":6,"./VRStoryDict.js":8,"./VRUIAccordionStacker.js":13,"./VRUINumberSlider.js":14,"./VRUISceneList.js":15}],2:[function(e,t){var i=e("./VRTextureDescription.js");VRDecal=function(){this.textureDescription=null,this.imgsrc=null,this.init=function(e){this.decal=e,this.textureDescription=new i,this.textureDescription.setSphereParamsFromString(this.decal.getAttribute("sphereParams")),this.textureDescription.plane=this.textureDescription.parseBoolString(this.decal.getAttribute("plane")),this.textureDescription.setPlaneOffsetParamsFromString(this.decal.getAttribute("planeOffset")),this.imgsrc=this.decal.getAttribute("src"),this.jumpTo=this.decal.getAttribute("jumpTo"),void 0==this.jumpTo&&(this.jumpTo="")},this.initDict=function(e){this.textureDescription=new i,this.textureDescription.initDict(e.textureDescription),this.jumpTo=e.jumpTo,this.imgsrc=e.imgsrc},this.getDecalElement=function(){var e=document.createElement("decal");return this.textureDescription.setElement(e),e.setAttribute("src",this.imgsrc),""!=this.jumpTo&&e.setAttribute("jumpTo",this.jumpTo),e}},t.exports=VRDecal},{"./VRTextureDescription.js":11}],3:[function(e,t){function n(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}var r=e("./VRSceneDict.js"),s=e("./VRURLParser.js"),o=e("./VRMacroStrings.js");String.prototype.padRight=function(e,t){return this+Array(e-this.length+1).join(t||" ")},String.prototype.contains=function(e){return-1!=this.indexOf(e)};var a=function(e,t){var i=t-e.length,n=(" "+e).slice(1);return i>0&&(n=n.padRight(i," ")),n},c={},h={},p={},d={},m={},g={},f=function(e){var t=null,n=e.split("/");for(i=0;l=n.length,i<l;i++)if(n[i].endsWith("imgur.com")&&i<l-1)return t=n[i+1],""==t?null:"a"==t?i<l-2?(t=n[i+2],[t,"album"]):null:"gallery"==t?i<l-2?(t=n[i+2],[t,"gallery"]):null:(partspl=t.split("."),""==partspl[0]?null:[partspl[0],"image"])},x=function(e,t,i,n){var r="";r+=t,r+=e,r+="?client_id=fe596e6329962dd";var s=new XMLHttpRequest;s.open("GET",r,!0),s.setRequestHeader("Authorization","Client-ID fe596e6329962dd"),s.setRequestHeader("Accept","application/json"),s.send(),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var t=JSON.parse(s.responseText);i(e,t,n)}}},S=function(e){var t=e.split("/"),i=t.pop(),n=i.split(".");return t.join("/")+"/"+n[0]+"b."+n[1]},_=function(e){if(null==e)return null;for(var t in o)if(e.contains(t))return t;return null},b=function(e){var t={};return 1==e.animated?null:e.height>4096||e.width>4096?null:(t.src=e.link,t.thumb=S(t.src),t.title=e.title,t.description=e.description,t.width=e.width,t.height=e.height,t.attribution="",t.misc=e.views+" views",t.macro=_(e.description),t)},D=function(e,t,i){d[e]=t;var n=(t.data.link,b(t.data)),r={};if(r.images=[n],r.galleryTitle=null,r.galleryDescription=null,r.galleryAttribution=null,r.galleryMisc=null,null!=i&&null!=r){var s=q(r);i(s)}},O=function(e,t){return e in d?void(null!=t&&D(d[e])):void x(e,"https://api.imgur.com/3/image/",D,t)},y=function(e,t,n){m[e]=t;var r=t.data.images,s=t.data.title,o=t.data.description,a=t.data.account_id,c=t.data.views+" views",h={};for(h.galleryTitle=s,h.galleryDescription=o,h.galleryAttribution=a,h.galleryMisc=c,h.images=[],i=0;l=r.length,i<l;i++){var u=r[i],p=b(u);null!=p&&h.images.push(p)}if(null!=n&&h!=[]){var d=q(h);n(d)}},I=function(e,t){return e in m?void(null!=t&&y(m[e])):void x(e,"https://api.imgur.com/3/album/",y,t)},V=function(e,t,n){g[e]=t;var r=t.data.images,s=t.data.title,o=t.data.description,a=t.data.account_id,c=t.data.views+" views",h={};for(h.galleryTitle=s,h.galleryDescription=o,h.galleryAttribution=a,h.galleryMisc=c,h.images=[],i=0;l=r.length,i<l;i++){var u=r[i],p=b(u);null!=p&&h.images.push(p)}if(null!=n&&h!=[]){var d=q(h);n(d)}},E=function(e,t){return e in g?void(null!=t&&V(g[e])):void x(e,"https://api.imgur.com/3/gallery/album/",V,t)},j=function(e,t,i,n){var r="";r+="https://api.flickr.com/services/rest/?",r+="&api_key=c074e17f92ea52a8d9422928352b0053",r+="&format=json",r+="&nojsoncallback=1",r+=t;var s=new XMLHttpRequest;s.open("GET",r,!0),s.send(),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var t=JSON.parse(s.responseText);i(e,t,n)}}},w=function(e){var t=e.split("/"),n=t.length;for(i=0;i<n&&!t[0].contains("flickr.com");i++)t.shift();return t==[]||"sets"!=t[3]&&"albums"!=t[3]?null:t[4]},U=function(e,t,n){var r=t.sizes.size,s=0,o=0,a="";for(i=0;i<r.length;i++){var l=parseInt(r[i].width);2048>=l&&l>o&&(o=l,s=i),r[i].source.endsWith("_m.jpg")&&(a=r[i].source)}""==a&&(a=r[s].source);var h={};h.photo_id=e,h.thumb=a,h.img=r[s].source,h.width=parseInt(r[s].width),h.height=parseInt(r[s].height),c[e]=h,n(c[e])},T=function(e,t){return null==e?!1:e in c?void t(c[e]):void j(e,"&method=flickr.photos.getSizes&photo_id="+e,U,t)},F=function(e,t,r){var s=t.photo.title._content,o=t.photo.description._content,a=t.photo.tags.tag,c=null;for(i=0;i<a.length;i++){var l=_(a[i].raw);null!=l&&(c=l)}var u={};u.photo_id=e,u.title=s,u.description=n(o),u.macro=c,h[e]=u,r(h[e])},R=function(e,t){return null==e?!1:e in h?void t(h[e]):void j(e,"&method=flickr.photos.getInfo&photo_id="+e,F,t)},k=function(e,t,n){var r=t.photoset.photo,s={};s.galleryTitle="",void 0!=t.photoset.title&&(s.galleryTitle=t.photoset.title),s.galleryDescription="",void 0!=t.photoset.ownername&&(s.galleryAttribution=t.photoset.ownername),s.galleryMisc="";var o=[];for(i=0;l=r.length,i<l;i++)o.push(r[i].id);p[e]=[s,o],n([s,o])},C=function(e,t){return null==e?!1:e in p?void t(p[e]):void j(e,"&method=flickr.photosets.getPhotos&photoset_id="+e,k,t)},P={},L=null,B=function(e,t,n){var r={},s=null,o=null;for(i=0;i<t.length;i++)t[i].photo_id==e&&(s=t[i]);for(i=0;i<n.length;i++)n[i].photo_id==e&&(o=n[i]);return null==s||null==o?null:(r.src=s.img,r.thumb=s.thumb,r.title=o.title,r.description=o.description,r.width=s.width,r.height=s.height,r.attribution="",r.misc="",r.macro=o.macro,r)},N=function(){var e=P.dt,t=P.photoIds.length;for(e.images=[],z=0;z<t;z++){var i=P.photoIds[z],n=B(i,P.imageURLs,P.imageInfos);null!=n&&e.images.push(n)}var r=q(e);null!=L&&L(r)},M=function(e){P.imageURLs.push(e),P.imageURLs.length==P.targetSize&&P.imageInfos.length==P.targetSize&&N()},A=function(e){P.imageInfos.push(e),P.imageURLs.length==P.targetSize&&P.imageInfos.length==P.targetSize&&N()},H=function(e){var t=e[0],n=e[1];for(P={},P.targetSize=n.length,P.dt=t,P.photoIds=n,P.imageURLs=[],P.imageInfos=[],i=0;i<n.length;i++)T(n[i],M),R(n[i],A)},G=70,J=function(e,t,i){return null==i?[e,t]:("vrEmbed:macro=360"==i?(e.textureDescription.sphereFOV=[360,180],e.textureDescription.plane=!1):"vrEmbed:macro=3dparallel"==i?(t.width=.5*t.width,e.textureDescription.sphereFOV=[G,G*t.height/t.width],e.textureDescription.isStereo=!0,e.textureDescription.U_l=[0,0],e.textureDescription.V_l=[.5,1],e.textureDescription.U_r=[.5,0],e.textureDescription.V_r=[1,1]):"vrEmbed:macro=3dcrosseye"==i?(t.width=.5*t.width,e.textureDescription.sphereFOV=[G,G*t.height/t.width],e.textureDescription.isStereo=!0,e.textureDescription.U_l=[.5,0],e.textureDescription.V_l=[1,1],e.textureDescription.U_r=[0,0],e.textureDescription.V_r=[.5,1]):"vrEmbed:macro=3d360"==i&&(e.textureDescription.sphereFOV=[360,180],e.textureDescription.plane=!1,e.textureDescription.isStereo=!0,e.textureDescription.U_l=[0,0],e.textureDescription.V_l=[1,.5],e.textureDescription.U_r=[0,.5],
e.textureDescription.V_r=[1,1]),[e,t])},q=function(e){var t=[],i=9;for(I=0;l=e.images.length,I<l;I++){var n=Math.floor(I/i),s=new r;s.init(),s.dict.name="image_"+I;var o=e.images[I],c=s.initPhoto();c.textureDescription.src=o.src,c.textureDescription.sphereFOV=[G,G*o.height/o.width],c.textureDescription.plane=!0;var h=J(c,o,o.macro),p=h[0],d=h[1];s.dict.photoObjects.push(p);var m="",g=45;null!=d.title&&(m+="Title: "+d.title+" \n"),null!=d.description&&(m+="Description: "+d.description+" \n");var f="";""!=d.misc&&(f+=d.misc),""!=d.attribution&&(f+=" "+d.attribution),m+=a(f,g)+" \n";var x=.2;if(""!=m){var S=s.initText();S.message=m,S.textOptions.borderthickness=0,S.textOptions.align="left",S.textOptions.fontface="Courier",S.textOptions.fontsize=36,S.textureDescription.sphereFOV=[G/1.5,20],S.textureDescription.sphereCentre=[G,0],S.textureDescription.plane=!0,S.textureDescription.planeOffset=[0,0],s.dict.textObjects.push(S)}var _=s.initDecal();_.imgsrc="http://vrembed.org/src/assets/vrEmbedLogo.png",_.textureDescription.sphereFOV=[2*G*x,2*G*x],_.textureDescription.sphereCentre=[0,-90],_.textureDescription.plane=!1,_.textureDescription.planeOffset=[0,0],s.dict.decalObjects.push(_);var b=-(.5+x)*(G*d.height/d.width);if(I>0){var D=s.initDecal(),O=e.images[I-1];D.jumpTo="image_"+(I-1),D.imgsrc=O.thumb,D.textureDescription.sphereFOV=[G*x,x*G*O.height/O.width],D.textureDescription.sphereCentre=[0,0],D.textureDescription.plane=!0,D.textureDescription.planeOffset=[-(.5-.5*x)*G,b],s.dict.decalObjects.push(D)}if(I<e.images.length-1){var D=s.initDecal(),O=e.images[I+1];D.jumpTo="image_"+(I+1),D.imgsrc=O.thumb,D.textureDescription.sphereFOV=[G*x,x*G*O.height/O.width],D.textureDescription.sphereCentre=[0,0],D.textureDescription.plane=!0,D.textureDescription.planeOffset=[(.5-.5*x)*G,b],s.dict.decalObjects.push(D)}var y=s.initDecal();y.jumpTo="index_"+n,y.imgsrc="http://vrembed.org/src/assets/gallery.png",y.textureDescription.sphereFOV=[G*x,G*x],y.textureDescription.sphereCentre=[0,0],y.textureDescription.plane=!0,y.textureDescription.planeOffset=[0,b],s.dict.decalObjects.push(y),t.push(s)}var I,V,E,j=e.images.length,w=i,U=Math.ceil(j/i),T=0,F=0;for(I=0,V=j;V>I;I+=w){E=e.images.slice(I,I+w);var R=0,s=new r;s.init(),s.dict.name="index_"+T;var k=30;for(v=0;v<3;v++){var C=-30;for(u=0;u<3&&!(F>=j);u++){var D=s.initDecal(),O=E[R];D.jumpTo="image_"+F,D.imgsrc=O.thumb,D.textureDescription.sphereFOV=[25,25],D.textureDescription.sphereCentre=[0,0],D.textureDescription.plane=!0,D.textureDescription.planeOffset=[C,k],s.dict.decalObjects.push(D),R+=1,F+=1,C+=30}k+=-30}if(T>0){var P=s.initDecal();P.jumpTo="index_"+(T-1),P.imgsrc="http://vrembed.org/src/assets/prevArrow.png",P.textureDescription.sphereFOV=[15,15],P.textureDescription.sphereCentre=[0,0],P.textureDescription.plane=!0,P.textureDescription.planeOffset=[-20,-60],s.dict.decalObjects.push(P)}if(U-1>T){var L=s.initDecal();L.jumpTo="index_"+(T+1),L.imgsrc="http://vrembed.org/src/assets/nextArrow.png",L.textureDescription.sphereFOV=[15,15],L.textureDescription.sphereCentre=[0,0],L.textureDescription.plane=!0,L.textureDescription.planeOffset=[20,-60],s.dict.decalObjects.push(L)}var _=s.initDecal();_.imgsrc="http://vrembed.org/src/assets/vrEmbedLogo.png",_.textureDescription.sphereFOV=[2*G*x,2*G*x],_.textureDescription.sphereCentre=[0,-90],_.textureDescription.plane=!1,_.textureDescription.planeOffset=[0,0],s.dict.decalObjects.push(_);var B=e.galleryTitle+" \n";B+=e.galleryDescription+" \n",B+="by "+e.galleryAttribution+" \n",B+=e.galleryMisc+" \n";var S=s.initText();S.message=B,S.textOptions.borderthickness=0,S.textOptions.align="left",S.textOptions.fontface="Courier",S.textOptions.fontsize=36,S.textureDescription.sphereFOV=[75,20],S.textureDescription.sphereCentre=[90,0],S.textureDescription.plane=!0,S.textureDescription.planeOffset=[0,0],s.dict.textObjects.push(S),t.push(s),T+=1}return t};VRImageLoader=function(){var e=this;this.sceneList=[],this.storyManager=null,this.vrURLParser=new s,this.vrURLParser.init(),this.init=function(e){this.storyManager=e},this.hasURLParams=function(){return this.vrURLParser.isEditor},this.getURLParameters=function(){return this.vrURLParser.params},this.isGalleryURL=function(){return"gallery"in this.getURLParameters()},this.isImageURL=function(){return"src"in this.getURLParameters()},this.getImages=function(t){e.getImagesCallback(t,this.buildFromImageList)},this.getImagesCallback=function(t,i){null!=e.getStory()&&e.getStory().setGallerySrc(t);var n=f(t);null!=n&&("image"==n[1]?O(n[0],i):"album"==n[1]?I(n[0],i):"gallery"==n[1]&&E(n[0],i));var r=w(t);null!=r&&(C(r,H),L=this.buildFromImageList),e.getStory().setLoading(!0)},this.parseBoolString=function(e){return void 0==e?!1:"true"==e.toLowerCase()?!0:!1},this.parsePlaneOffsetParamsFromString=function(e){if(void 0!=e){var t=e.split(",");return[parseFloat(t[0].trim()),parseFloat(t[1].trim())]}},this.getSphereParamsFromString=function(e){var t=e.split(",");return[[parseFloat(t[0].trim()),parseFloat(t[1].trim())],[parseFloat(t[2].trim()),parseFloat(t[3].trim())]]},this.getTexParamsFromString=function(e){var t=e.split(",");return[[parseFloat(t[0].trim()),parseFloat(t[1].trim())],[parseFloat(t[2].trim()),parseFloat(t[3].trim())],[parseFloat(t[4].trim()),parseFloat(t[5].trim())],[parseFloat(t[6].trim()),parseFloat(t[7].trim())]]},this.buildFromImageURLParams=function(e){var t=new Image;t.onload=this.buildSingle,t.src=e.src},this.buildSingle=function(){var t=e.getURLParameters(),i=new r;i.init();var n=i.initPhoto();if(n.name="unit",n.textureDescription.src=t.src,n.textureDescription.metaSource=void 0!=t.metaSrc?t.metaSrc:"",n.textureDescription.isStereo=e.parseBoolString(t.isStereo),n.textureDescription.plane=e.parseBoolString(t.plane),n.textureDescription.planeOffset=e.parsePlaneOffsetParamsFromString(t.planeOffset),void 0!=t.sphereParams){var s=e.getSphereParamsFromString(t.sphereParams);n.textureDescription.sphereFOV=s[0],n.textureDescription.sphereCentre=s[1]}if(void 0!=t.texParams){var o=e.getTexParamsFromString(t.texParams);n.textureDescription.U_l=o[0],n.textureDescription.V_l=o[1],n.textureDescription.U_r=o[2],n.textureDescription.V_r=o[3]}i.dict.photoObjects.push(n);var a=[];a.push(i),e.pushFromDictToRender(a),e.getStory().setLoading(!1)},this.buildFromImageList=function(t){e.pushFromDictToRender(t),e.getStory().setLoading(!1)},this.getStory=function(){return null==e.storyManager?null:e.storyManager.storyList!=[]?e.storyManager.storyList[0]:null},this.pushFromDictToRender=function(t){if(null!=e.getStory()){for(e.getStory().sceneList=[],e.getStory().namedSceneMap={},i=0;i<t.length;i++){var n=t[i];n.vrScene.initDict(t[i].dict),e.getStory().sceneList.push(n.vrScene),e.getStory().namedSceneMap[n.vrScene.name]=i}e.getStory().setupScene(0)}}};var X=function(){function e(){var e=new VRImageLoader;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}();t.exports=X.getInstance()},{"./VRMacroStrings.js":4,"./VRSceneDict.js":6,"./VRURLParser.js":16}],4:[function(e,t){VRMacroStrings={"vrEmbed:macro=360":0,"vrEmbed:macro=3dparallel":1,"vrEmbed:macro=3dcrosseye":2,"vrEmbed:macro=3d360":3},t.exports=VRMacroStrings},{}],5:[function(e,t){var n=e("./VRScenePhoto.js"),r=e("./VRText.js"),s=e("./VRDecal.js");VRScene=function(){this.sceneElement=null,this.photoObjects=[],this.textObjects=[],this.decalObjects=[],this.oldScroll=null,this.isStereo=!1,this.name="",this.parseChildNode=function(e){if("PHOTO"==e.nodeName){var t=new n;t.init(e),1==t.isStereo()&&(this.isStereo=!0),this.photoObjects.push(t)}else if("TEXT"==e.nodeName){var i=new r;i.init(e),this.textObjects.push(i)}else if("DECAL"==e.nodeName){var o=new s;o.init(e),this.decalObjects.push(o)}for(var a=e.childNodes,c=0,l=a.length;l>c;++c){var h=a[c];1===h.nodeType&&this.parseChildNode(h)}},this.init=function(e){this.sceneElement=e;var t=e.getAttribute("name");null!=t&&(this.name=t);for(var i=e.childNodes,n=0,r=i.length;r>n;++n){var s=i[n];1===s.nodeType&&this.parseChildNode(s)}},this.initDict=function(e){this.photoObjects=[],this.textObjects=[],this.decalObjects=[];for(var t=0,i=e.photoObjects.length;i>t;++t){var o=new n;o.initDict(e.photoObjects[t]),this.photoObjects.push(o)}for(var t=0,i=e.textObjects.length;i>t;++t){var a=new r;a.initDict(e.textObjects[t]),this.textObjects.push(a)}for(var t=0,i=e.decalObjects.length;i>t;++t){var c=new s;c.initDict(e.decalObjects[t]),this.decalObjects.push(c)}this.name=e.name},this.initVrEmbedPhoto=function(e){var t=new n;t.init(e),1==t.isStereo()&&(this.isStereo=!0),this.photoObjects.push(t)},this.getSceneElement=function(){var e=document.createElement("scene");for(""!=this.name&&e.setAttribute("name",this.name),i=0;i<this.photoObjects.length;i++)e.appendChild(this.photoObjects[i].getPhotoElement());for(j=0;j<this.textObjects.length;j++)e.appendChild(this.textObjects[j].getTextElement());for(k=0;k<this.decalObjects.length;k++)e.appendChild(this.decalObjects[k].getDecalElement());return e},this.hasJumpNav=function(){for(j=0;j<this.textObjects.length;j++)if(""!=this.textObjects[j].jumpTo)return!0;for(j=0;j<this.decalObjects.length;j++)if(""!=this.decalObjects[j].jumpTo)return!0;return!1}},t.exports=VRScene},{"./VRDecal.js":2,"./VRScenePhoto.js":7,"./VRText.js":9}],6:[function(e,t){VRSceneDict=function(){this.dict=null,this.vrScene=null,this.init=function(){this.vrScene=new VRScene,this.dict={},this.dict.photoObjects=[],this.dict.textObjects=[],this.dict.decalObjects=[],this.dict.name=""},this.initFromVrScene=function(e){for(this.vrScene=e,this.dict={},this.dict.name=e.name,this.dict.photoObjects=[],this.dict.textObjects=[],this.dict.decalObjects=[],i=0;i<e.photoObjects.length;i++)this.dict.photoObjects.push(this.initFromScenePhoto(e.photoObjects[i]));for(i=0;i<e.textObjects.length;i++)this.dict.textObjects.push(this.initFromText(e.textObjects[i]));for(i=0;i<e.decalObjects.length;i++)this.dict.decalObjects.push(this.initFromDecal(e.decalObjects[i]))},this.initFromTextureDescription=function(e){var t={};return t.src=e.textureSource,t.metaSource=e.metaSource,t.isStereo=e.isStereo,t.sphereFOV=e.sphereFOV,t.sphereCentre=e.sphereCentre,t.planeOffset=e.planeOffset,t.U_l=e.U_l,t.V_l=e.V_l,t.U_r=e.U_r,t.V_r=e.V_r,t.plane=e.plane,t},this.initFromTextOptions=function(e){var t={};return t.align=e.align,t.fontface=e.fontface,t.fontsize=e.fontsize,t.borderThickness=e.borderthickness,t.borderColor=e.bordercolor,t.backgroundColor=e.backgroundcolor,t.textColor=e.textcolor,t},this.initFromScenePhoto=function(e){var t={};return t.textureDescription=this.initFromTextureDescription(e.textureDescription),t},this.initPhoto=function(){var e={};return e.textureDescription={},e.textureDescription.src="http://vrembed.org/src/assets/vrEmbedLogo.png",e.textureDescription.isStereo=!1,e.textureDescription.plane=!1,e.textureDescription.sphereFOV=[60,60],e.textureDescription.sphereCentre=[0,0],e.textureDescription.planeOffset=[0,0],e.textureDescription.U_l=[0,0],e.textureDescription.V_l=[.5,1],e.textureDescription.U_r=[.5,0],e.textureDescription.V_r=[1,1],e},this.initFromText=function(e){var t={};return t.textureDescription=this.initFromTextureDescription(e.textureDescription),t.textOptions=this.initFromTextOptions(e.textOptions),t.message=e.message,t.jumpTo=e.jumpTo,t},this.initText=function(){var e={};return e.message="Placeholder text",e.jumpTo="",e.textureDescription={},e.textureDescription.src="",e.textureDescription.isStereo=!1,e.textureDescription.plane=!1,e.textureDescription.sphereFOV=[60,40],e.textureDescription.sphereCentre=[0,0],e.textureDescription.planeOffset=[0,0],e.textOptions={},e.textOptions.align="center",e.textOptions.fontface="Arial",e.textOptions.fontsize="72",e.textOptions.borderthickness="12",e.textOptions.bordercolor="#FFFFFF",e.textOptions.backgroundcolor="#000000",e.textOptions.textcolor="#FFFFFF",e},this.initFromDecal=function(e){var t={};return t.textureDescription=this.initFromTextureDescription(e.textureDescription),e.imgsrc=e.imgsrc,e.jumpTo=e.jumpTo,text},this.initDecal=function(){var e={};return e.imgsrc="http://vrembed.org/src/assets/vrEmbedLogo.png",e.jumpTo="",e.textureDescription={},e.textureDescription.src="",e.textureDescription.isStereo=!1,e.textureDescription.plane=!0,e.textureDescription.sphereFOV=[30,30],e.textureDescription.sphereCentre=[0,0],e.textureDescription.planeOffset=[0,0],e},this.addDecal=function(){var e=this.initDecal();this.dict.decalObjects.push(e)},this.removeDecal=function(e){this.dict.decalObjects.splice(e,1)},this.addPhoto=function(){var e=this.initPhoto();this.dict.photoObjects.push(e)},this.removePhoto=function(e){this.dict.photoObjects.splice(e,1)},this.addText=function(){var e=this.initText();this.dict.textObjects.push(e)},this.removeText=function(e){this.dict.textObjects.splice(e,1)}},t.exports=VRSceneDict},{}],7:[function(e,t){var i=e("./VRTextureDescription.js");VRScenePhoto=function(){this.scenePhoto=null,this.textureDescription=null,this.init=function(e){this.scenePhoto=e,this.textureDescription=new i,this.textureDescription.init(e)},this.initDict=function(e){this.textureDescription=new i,this.textureDescription.initDict(e.textureDescription)},this.populateElementCommon=function(e){this.textureDescription.setElement(e)},this.isStereo=function(){return this.textureDescription.isStereo},this.getPhotoElement=function(){var e=document.createElement("photo");return this.populateElementCommon(e),e},this.getSinglePhotoVrEmbedElement=function(){var e=document.createElement("a");return e.setAttribute("class","vrEmbedPhoto"),this.populateElementCommon(e),e},this.getSinglePhotoURLParams=function(){var e="?";return e+="src="+this.textureDescription.getAbsoluteTexturePath(),e+="&sphereParams="+this.textureDescription.getSphereParamsString(),0==this.isStereo()?e+="&isStereo=false":(e+="&isStereo=true",e+="&texParams="+this.textureDescription.getTexParamsString()),0==this.textureDescription.plane?e+="&plane=false":(e+="&plane=true",e+="&planeOffset="+this.textureDescription.getPlaneOffsetParamsString()),e}},t.exports=VRScenePhoto},{"./VRTextureDescription.js":11}],8:[function(e,t){{var i=e("./VRSceneDict.js");e("./VRUISceneList.js")}VRStoryDict=function(){this.init=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.getElementsByTagName("story");if(0==n.length)return null;var r=[];for(storyit=0;storyit<n.length;storyit++)for(var s=n[storyit],o=s.childNodes,a=0,c=o.length;c>a;++a){var l=o[a];if(1===l.nodeType&&"SCENE"==l.nodeName){var h=new VRScene;h.init(l);var u=new i;u.initFromVrScene(h),r.push(u)}}return t.remove(),r}},t.exports=VRStoryDict},{"./VRSceneDict.js":6,"./VRUISceneList.js":15}],9:[function(e,t){var i=e("./VRTextureDescription.js"),n=e("./VRTextOptions.js");VRText=function(){this.sceneText=null,this.textureDescription=null,this.textOptions=null,this.message="",this.jumpTo="",this.parseMessage=function(e){this.message=e},this.parseBoolString=function(e){return void 0==e?!1:"true"==e.toLowerCase()?!0:!1},this.init=function(e){this.sceneText=e,this.sceneText.setAttribute("hidden",!0),this.parseMessage(this.sceneText.innerHTML),this.jumpTo=this.sceneText.getAttribute("jumpTo"),void 0==this.jumpTo&&(this.jumpTo=""),this.textureDescription=new i,this.textureDescription.init(this.sceneText),this.textOptions=new n,this.textOptions.init(this.sceneText)},this.initDict=function(e){this.textureDescription=new i,this.textureDescription.initDict(e.textureDescription),this.parseMessage(e.message),this.jumpTo=e.jumpTo,this.textOptions=new n,this.textOptions.initDict(e.textOptions)},this.getTextElement=function(){var e=document.createElement("text");return this.textureDescription.setElement(e),e.innerHTML=this.message,""!=this.jumpTo&&e.setAttribute("jumpTo",this.jumpTo),this.textOptions.setElement(e),e}},t.exports=VRText},{"./VRTextOptions.js":10,"./VRTextureDescription.js":11}],10:[function(e,t){VRTextOptions=function(){this.align=null,this.fontface=null,this.fontsize=null,this.borderThickness=null,this.borderColor=null,this.backgroundColor=null,this.textColor=null,this.init=function(e){this.align=e.getAttribute("align"),this.fontface=e.getAttribute("fontface"),this.fontsize=e.getAttribute("fontsize"),this.borderThickness=e.getAttribute("borderthickness"),this.borderColor=e.getAttribute("bordercolor"),this.backgroundColor=e.getAttribute("backgroundcolor"),this.textColor=e.getAttribute("textcolor")},this.initDict=function(e){this.align=e.align,this.fontface=e.fontface,this.fontsize=e.fontsize,this.borderThickness=e.borderthickness,this.borderColor=e.bordercolor,this.backgroundColor=e.backgroundcolor,this.textColor=e.textcolor},this.setElement=function(e){null!=this.align&&e.setAttribute("align",this.align),null!=this.fontface&&e.setAttribute("fontface",this.fontface),null!=this.fontsize&&e.setAttribute("fontsize",this.fontsize),null!=this.borderThickness&&e.setAttribute("borderthickness",this.borderThickness),null!=this.borderColor&&e.setAttribute("bordercolor",this.borderColor),null!=this.backgroundColor&&e.setAttribute("backgroundcolor",this.backgroundColor),null!=this.textColor&&e.setAttribute("textcolor",this.textColor)}},t.exports=VRTextOptions},{}],11:[function(e,t){VRTextureDescription=function(){this.textureSource="",this.metaSource="",this.isStereo=!1,this.sphereFOV=[360,180],this.sphereCentre=[0,0],this.U_l=[0,0],this.V_l=[1,1],this.U_r=[0,0],this.V_r=[1,1],this.plane=!1,this.planeOffset=[0,0],this.parseBoolString=function(e){return void 0==e?!1:"true"==e.toLowerCase()?!0:!1},this.setPlaneOffsetParamsFromString=function(e){if(void 0!=e){var t=e.split(",");this.planeOffset=[parseFloat(t[0].trim()),parseFloat(t[1].trim())]}},this.setSphereParamsFromString=function(e){var t=e.split(",");this.sphereFOV=[parseFloat(t[0].trim()),parseFloat(t[1].trim())],this.sphereCentre=[parseFloat(t[2].trim()),parseFloat(t[3].trim())]},this.setTexParamsFromString=function(e){var t=e.split(",");this.U_l=[parseFloat(t[0].trim()),parseFloat(t[1].trim())],this.V_l=[parseFloat(t[2].trim()),parseFloat(t[3].trim())],this.U_r=[parseFloat(t[4].trim()),parseFloat(t[5].trim())],this.V_r=[parseFloat(t[6].trim()),parseFloat(t[7].trim())]},this.getPlaneOffsetParamsString=function(){return this.planeOffset[0]+","+this.planeOffset[1]},this.getSphereParamsString=function(){return this.sphereFOV[0]+","+this.sphereFOV[1]+","+this.sphereCentre[0]+","+this.sphereCentre[1]},this.getTexParamsString=function(){return this.U_l[0]+","+this.U_l[1]+","+this.V_l[0]+","+this.V_l[1]+","+this.U_r[0]+","+this.U_r[1]+","+this.V_r[0]+","+this.V_r[1]},this.getAbsoluteTexturePath=function(){var e=document.createElement("a");return e.href=this.textureSource,e.protocol+"//"+e.host+e.pathname+e.search+e.hash},this.init=function(e){this.setSphereParamsFromString(e.getAttribute("sphereParams")),this.plane=this.parseBoolString(e.getAttribute("plane")),this.setPlaneOffsetParamsFromString(e.getAttribute("planeOffset")),this.textureSource=e.getAttribute("src"),void 0==this.textureSource&&(this.textureSource=""),this.metaSource="",this.isStereo=this.parseBoolString(e.getAttribute("isStereo")),void 0==this.isStereo&&(this.isStereo=!1),1==this.isStereo&&this.setTexParamsFromString(e.getAttribute("texParams"))},this.initDict=function(e){return this.textureSource=e.src,null==this.textureSource?void(this.textureSource=null):(this.metaSource="",this.isStereo=e.isStereo,this.plane=e.plane,this.sphereFOV=e.sphereFOV,this.sphereCentre=e.sphereCentre,this.planeOffset=e.planeOffset,void(this.isStereo&&(this.U_l=e.U_l,this.V_l=e.V_l,this.U_r=e.U_r,this.V_r=e.V_r)))},this.setElement=function(e){""!=this.textureSource&&e.setAttribute("src",this.getAbsoluteTexturePath()),e.setAttribute("sphereParams",this.getSphereParamsString()),0==this.plane?e.setAttribute("plane","false"):(e.setAttribute("plane","true"),e.setAttribute("planeOffset",this.getPlaneOffsetParamsString())),0==this.isStereo?e.setAttribute("isStereo","false"):(e.setAttribute("isStereo","true"),e.setAttribute("texParams",this.getTexParamsString()))}},t.exports=VRTextureDescription},{}],12:[function(e,t){VRUIAccordion=function(){var e=this;this.bar=null,this.button=null,this.container=null,this.shown=!1,this.accordionManager=!1,this.name=null,this.totalHide=function(t){e.container.hidden=t,e.bar.hidden=t},this.show=function(t){e.shown=t,0==t?(e.container.hidden=!0,e.button.innerHTML="+"):(e.container.hidden=!1,e.button.innerHTML="-")},this.toggle=function(){e.accordionManager.toggle(e.name)},this.init=function(e,t){this.name=t,this.accordionManager=e,this.container=document.getElementById(t),this.button=document.getElementById(t+"_button"),this.bar=document.getElementById(t+"_bar"),this.button.onclick=this.toggle,this.show(!1)}},t.exports=VRUIAccordion},{}],13:[function(e,t){var n=e("./VRUIAccordion.js");VRUIAccordionStacker=function(){var e=this;this.accordions=[],this.active=null,this.add=function(t){var i=new n;i.init(e,t),e.accordions.push([t,i])},this.showNamed=function(t){for(i=0;i<e.accordions.length;i++)t==e.accordions[i][0]?(e.active=t,e.accordions[i][1].show(!0)):e.accordions[i][1].show(!1)},this.toggle=function(t){e.active!=t&&e.showNamed(t)},this.totalHide=function(t,n){for(i=0;i<e.accordions.length;i++)if(t==e.accordions[i][0])return void e.accordions[i][1].totalHide(n)}},t.exports=VRUIAccordionStacker},{"./VRUIAccordion.js":12}],14:[function(e,t){var i=function(){var e=this;this.sliderElement=null,this.textElement=null,this.callback=null,this.sliderMove=function(){e.textElement.value=e.sliderElement.value},this.inputStateChange=function(){e.textElement.value=e.sliderElement.value,e.callback()},this.textChange=function(){return parseFloat(e.textElement.value)<parseFloat(e.sliderElement.min)||parseFloat(e.textElement.value)>parseFloat(e.sliderElement.max)?void(e.textElement.value=e.sliderElement.value):(e.sliderElement.value=e.textElement.value,void e.callback())},this.set=function(t){e.sliderElement.value=t,e.textElement.value=t},this.get=function(){return e.sliderElement.value},this.init=function(e,t,i,n){this.sliderElement=e,this.textElement=t,this.set(i),this.callback=n,this.sliderElement.oninput=this.sliderMove,this.sliderElement.onchange=this.inputStateChange,this.textElement.onchange=this.textChange}};t.exports=i},{}],15:[function(e,t){VRUISceneList=function(){this.scenes=[],this.sceneIdx=-1,this.init=function(){this.addScene(),this.sceneIdx=0},this.addScene=function(){var e=new VRSceneDict;e.init(),this.scenes.push(e)},this.getScene=function(e){return this.scenes[e]},this.removeScene=function(e){this.scenes.length>1&&this.scenes.splice(e,1)}},t.exports=VRUISceneList},{}],16:[function(e,t){function i(){var e=window.location.search.substr(1);return null!=e&&""!=e?n(e):{}}function n(e){for(var t={},i=e.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");t[r[0]]=decodeURIComponent(r[1])}return t}VRURLParser=function(){this.isEditor=!1,this.params=[],this.scenePhoto=null,this.parseURL=function(){this.params=i()},this.init=function(){var e=document.getElementsByTagName("vrEditor");this.parseURL();var t=0;for(var i in this.params)t+=1;0!=e.length&&0!=t&&(this.isEditor=!0)}},t.exports=VRURLParser},{}],17:[function(e){{var t=e("./VRCreateUI.js");new t}},{"./VRCreateUI.js":1}]},{},[17]);