!function e(t,i,n){function s(r,c){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!c&&l)return l(r,!0);if(o)return o(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){var i=t[r][1][e];return s(i?i:e)},h,h.exports,e,t,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(e,t,n){var s=(e("./VRScene.js"),e("./VRUINumberSlider.js")),o=e("./VRUIAccordionStacker.js"),r=(e("./VRSceneDict.js"),e("./VRUISceneList.js")),c=e("./VRStoryDict.js"),l={},a=function(e,t){var n=null,s=e.split("/");for(i=0;i<s.length;i++)if("photos"==s[i]&&i+2<s.length){n=s[i+2];break}if(null==n)return!1;if(n in l)return void t(l[n]);var o="";o+="https://api.flickr.com/services/rest/?",o+="&method=flickr.photos.getSizes",o+="&api_key=c074e17f92ea52a8d9422928352b0053",o+="&photo_id="+n,o+="&format=json",o+="&nojsoncallback=1";var r=new XMLHttpRequest;r.open("GET",o,!0),r.send(),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText),s=e.sizes.size,o=0,c=0;for(i=0;i<s.length;i++)s[i].width<=2048&&s[i].width>c&&(c=s[i].width,o=i);l[n]=s[o].source,t(l[n])}}};VRCreateUI=function(){var e=this;this.firstRun=!0,this.storyManager=null,this.photoIdx=0,this.sceneIdx=0,this.sceneList=new r,this.sceneSelect=null,this.sceneName=null,this.elementSelect=null,this.imageURL=null,this.imagePreviewCanvas=null,this.hfovVRUINumberSlider=null,this.vfovVRUINumberSlider=null,this.xposVRUINumberSlider=null,this.yposVRUINumberSlider=null,this.isPlane=null,this.isStereo=null,this.U_l_x_slider=null,this.U_l_y_slider=null,this.V_l_x_slider=null,this.V_l_y_slider=null,this.U_r_x_slider=null,this.U_r_y_slider=null,this.V_r_x_slider=null,this.V_r_y_slider=null,this.textMessage=null,this.jumpTo=null,this.jumpText=null,this.fontAlign=null,this.fontFace=null,this.fontSize=null,this.borderThickness=null,this.borderColor=null,this.backgroundColor=null,this.textColor=null,this.accordionStacker=null,this.oneImage=null,this.modeOneImage=null,this.modeNewStory=null,this.existingStory=null,this.modeExistingStory=null,this.oneImageMode="single",this.exportEquirectangularButton=null,this.getStory=function(){return e.storyManager.storyList!=[]?this.storyManager.storyList[0]:null},this.setPanelVisibility=function(){if(""==e.elementSelect.value)return e.showImageOptions(!1),e.showOptionsPosition(!1),e.showOptionsPosition3D(!1),e.showOptionsPlanar(!1),e.showOptionsText(!1),e.showOptionsJump(!1),void e.showOptionsTextCommon(!1);var t=e.elementSelect.value.split("_"),i=t[0];"photo"==i?(e.showImageOptions(!0),e.showOptionsPosition(!0),e.showOptionsPosition3D(!0),e.showOptionsPlanar(!0),e.showStereoOptions(e.isStereo.checked),e.showOptionsText(!1),e.showOptionsJump(!1),e.showOptionsTextCommon(!1)):"text"==i?(e.showImageOptions(!1),e.showOptionsPosition(!0),e.showOptionsPosition3D(!1),e.showOptionsPlanar(!0),e.showOptionsText(!0),e.showOptionsJump(!1),e.showOptionsTextCommon(!0)):"jump"==i&&(e.showImageOptions(!1),e.showOptionsPosition(!0),e.showOptionsPosition3D(!1),e.showOptionsPlanar(!0),e.showOptionsText(!1),e.showOptionsJump(!0),e.showOptionsTextCommon(!0))},this.showImageOptions=function(e){document.getElementById("options_image_load").hidden=!e},this.showOptionsPosition=function(e){document.getElementById("options_position").hidden=!e},this.showOptionsPosition3D=function(e){document.getElementById("options_position_3d").hidden=!e},this.showOptionsPlanar=function(e){document.getElementById("options_planar").hidden=!e},this.showOptionsText=function(e){document.getElementById("options_text").hidden=!e},this.showOptionsTextCommon=function(e){document.getElementById("options_text_common").hidden=!e},this.showOptionsJump=function(e){document.getElementById("options_jump").hidden=!e},this.showStereoOptions=function(e){var t=document.getElementById("options_stereo");e?t.hidden=!1:t.hidden=!0},this.inputStateChange=function(){if(""!=e.elementSelect.value){var t=e.elementSelect.value.split("_"),i=t[0],n=t[1],s=e.sceneList.scenes[e.sceneSelect.value];if("photo"==i){var o=s.dict.photoObjects[n],r=parseFloat(e.hfovVRUINumberSlider.get()),c=parseFloat(e.vfovVRUINumberSlider.get()),l=parseFloat(e.xposVRUINumberSlider.get()),h=parseFloat(e.yposVRUINumberSlider.get());o.textureDescription.sphereFOV[0]=r,o.textureDescription.sphereFOV[1]=c,o.textureDescription.sphereCentre[0]=l,o.textureDescription.sphereCentre[1]=h,o.textureDescription.src=e.imageURL.value,o.textureDescription.plane=e.isPlane.checked,o.textureDescription.isStereo=e.isStereo.checked,o.textureDescription.U_l=[parseFloat(e.U_l_x_slider.get()),parseFloat(e.U_l_y_slider.get())],o.textureDescription.V_l=[parseFloat(e.V_l_x_slider.get()),parseFloat(e.V_l_y_slider.get())],o.textureDescription.U_r=[parseFloat(e.U_r_x_slider.get()),parseFloat(e.U_r_y_slider.get())],o.textureDescription.V_r=[parseFloat(e.V_r_x_slider.get()),parseFloat(e.V_r_y_slider.get())]}else if("text"==i){var u=s.dict.textObjects[n],r=parseFloat(e.hfovVRUINumberSlider.get()),c=parseFloat(e.vfovVRUINumberSlider.get()),l=parseFloat(e.xposVRUINumberSlider.get()),h=parseFloat(e.yposVRUINumberSlider.get());u.textureDescription.sphereFOV[0]=r,u.textureDescription.sphereFOV[1]=c,u.textureDescription.sphereCentre[0]=l,u.textureDescription.sphereCentre[1]=h,u.textureDescription.plane=e.isPlane.checked,u.message=e.textMessage.value,u.textOptions.align=e.fontAlign.value,u.textOptions.fontface=e.fontFace.value,u.textOptions.fontsize=e.fontSize.value,u.textOptions.borderthickness=e.borderThickness.value,u.textOptions.bordercolor=e.borderColor.value,u.textOptions.backgroundcolor=e.backgroundColor.value,u.textOptions.textcolor=e.textColor.value}else if("jump"==i){var d=s.dict.jumpObjects[n],r=parseFloat(e.hfovVRUINumberSlider.get()),c=parseFloat(e.vfovVRUINumberSlider.get()),l=parseFloat(e.xposVRUINumberSlider.get()),h=parseFloat(e.yposVRUINumberSlider.get());d.textureDescription.sphereFOV[0]=r,d.textureDescription.sphereFOV[1]=c,d.textureDescription.sphereCentre[0]=l,d.textureDescription.sphereCentre[1]=h,d.textureDescription.plane=e.isPlane.checked,d.jumpTo=e.jumpTo.value,d.jumpText=e.jumpText.value,d.textOptions.align=e.fontAlign.value,d.textOptions.fontface=e.fontFace.value,d.textOptions.fontsize=e.fontSize.value,d.textOptions.borderthickness=e.borderThickness.value,d.textOptions.bordercolor=e.borderColor.value,d.textOptions.backgroundcolor=e.backgroundColor.value,d.textOptions.textcolor=e.textColor.value}if(e.setPanelVisibility(),"photo"==i){var p=e.imageURL.value;if(-1!=p.indexOf("flickr.com/photos"))return void a(p,e.deferredImageUpdate);e.updateImagePreview()}e.pushFromDictToRender()}},this.deferredImageUpdate=function(t){var i=e.elementSelect.value.split("_"),n=(i[0],i[1]),s=e.sceneList.scenes[e.sceneSelect.value],o=s.dict.photoObjects[n];o.textureDescription.src=t,e.imagePreview.src=t,e.updateImagePreview(),e.pushFromDictToRender()},this.updateImagePreview=function(){var t=1024,i=e.imagePreviewCanvas.getContext("2d");i.clearRect(0,0,t,t);var n,s,o,r,c=i.canvas.clientWidth,l=i.canvas.clientHeight,a=e.imagePreview.width,h=e.imagePreview.height,u=c/l,d=a/h;if(d>u?(o=t,r=o*u):u>1&&d>1?(r=t,o=r/u):u>d?(r=t,o=r/u):(o=t,r=o*u),n=.5*t-.5*o,s=.5*t-.5*r,e.isStereo.checked){i.globalAlpha=.5,i.drawImage(e.imagePreview,n,s,o,r),i.globalAlpha=1,i.strokeStyle="rgba(0,0,0,1.0)",i.fillStyle=i.strokeStyle,i.lineWidth=4,i.moveTo(n,s),i.lineTo(n+o,s),i.moveTo(n,s+.5*r),i.lineTo(n+o,s+.5*r),i.moveTo(n,s+r),i.lineTo(n+o,s+r),i.moveTo(n,s),i.lineTo(n,s+r),i.moveTo(n+.5*o,s),i.lineTo(n+.5*o,s+r),i.moveTo(n+o,s),i.lineTo(n+o,s+r),i.stroke(),i.font="32px Arial",i.fillText("(0,0)",n,s+32),i.fillText("(0,0.5)",n,s+.5*r-32),i.fillText("(0,1)",n,s+r-32),i.fillText("(0.5,0)",n+.5*o-96,s+32),i.fillText("(0.5,0.5)",n+.5*o-116,s+.5*r-32),i.fillText("(0.5,1)",n+.5*o-96,s+r-32),i.fillText("(1,0)",n+o-72,s+32),i.fillText("(1,0.5)",n+o-96,s+.5*r-32),i.fillText("(1,1)",n+o-72,s+r-32),i.lineWidth=1,i.font="Bold 64px Arial";var p=[parseFloat(e.U_l_x_slider.get()),parseFloat(e.U_l_y_slider.get())],m=[parseFloat(e.V_l_x_slider.get()),parseFloat(e.V_l_y_slider.get())];U=[n+p[0]*o,s+p[1]*r],V=[n+m[0]*o,s+m[1]*r],i.fillStyle="rgba(255,0,0,0.5)",i.strokeStyle="rgba(255,0,0,0.5)",i.fillRect(U[0],U[1],V[0]-U[0],V[1]-U[1]),i.stroke(),i.fillStyle="rgba(255,0,0,1.0)",i.strokeStyle="rgba(255,0,0,1.0)",i.fillText("Left",U[0],U[1]+64);var g=[parseFloat(e.U_r_x_slider.get()),parseFloat(e.U_r_y_slider.get())],x=[parseFloat(e.V_r_x_slider.get()),parseFloat(e.V_r_y_slider.get())];U=[n+g[0]*o,s+g[1]*r],V=[n+x[0]*o,s+x[1]*r],i.fillStyle="rgba(0,0,255,0.5)",i.strokeStyle="rgba(0,0,255,0.5)",i.fillRect(U[0],U[1],V[0]-U[0],V[1]-U[1]),i.stroke(),i.fillStyle="rgba(0,0,255,1.0)",i.strokeStyle="rgba(0,0,255,1.0)",i.fillText("Right",U[0],U[1]+64)}else i.drawImage(e.imagePreview,n,s,o,r)},this.loadImage=function(){e.imagePreview.onload=e.updateImagePreview,e.inputStateChange();var t=e.imageURL.value;e.imagePreview.src=t},this.updateSceneListDropdown=function(){for(e.sceneSelect.innerHTML="",i=0;i<e.sceneList.scenes.length;i++){var t=e.sceneList.scenes[i],n=document.createElement("option");n.value=i,""!=t.dict.name?n.innerHTML=t.dict.name:n.innerHTML=i,e.sceneSelect.appendChild(n)}},this.populateGUIFromSceneDict=function(t){e.sceneSelect.value=t,e.elementSelect.innerHTML="";var n=e.sceneList.scenes[t];for(this.sceneName.value=n.dict.name,i=0;i<n.dict.photoObjects.length;i++){var s=document.createElement("option");s.value="photo_"+i,s.innerHTML="Image "+(i+1),e.elementSelect.appendChild(s)}for(i=0;i<n.dict.textObjects.length;i++){var s=document.createElement("option");s.value="text_"+i,s.innerHTML="Text "+(i+1),e.elementSelect.appendChild(s)}for(i=0;i<n.dict.jumpObjects.length;i++){var s=document.createElement("option");s.value="jump_"+i,s.innerHTML="Jump "+(i+1),e.elementSelect.appendChild(s)}e.pushFromDictToRender()},this.pushFromGUIToDict=function(){e.sceneList.scenes[e.sceneSelect.value].dict.name=e.sceneName.value,e.updateSceneListDropdown(),e.pushFromDictToRender()},this.addImage=function(){var t=e.sceneList.scenes[e.sceneSelect.value];t.addPhoto(),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="photo_"+(t.dict.photoObjects.length-1),e.selectElement(),e.accordionStacker.showNamed("setup_scene_object")},this.addText=function(){var t=e.sceneList.scenes[e.sceneSelect.value];t.addText(),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="text_"+(t.dict.textObjects.length-1),e.selectElement(),e.accordionStacker.showNamed("setup_scene_object")},this.addJump=function(){var t=e.sceneList.scenes[e.sceneSelect.value];t.addJump(),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="jump_"+(t.dict.jumpObjects.length-1),e.selectElement(),e.accordionStacker.showNamed("setup_scene_object")},this.removeElement=function(){if(""!=e.elementSelect.value){var t=e.elementSelect.value.split("_"),i=t[0],n=t[1],s=e.sceneList.scenes[e.sceneSelect.value];"photo"==i?s.removePhoto(n):"text"==i?s.removeText(n):"jump"==i&&s.removeJump(n),e.populateGUIFromSceneDict(e.sceneSelect.value)}},this.pushFromDictToRender=function(){if(null!=e.getStory()){for(e.getStory().sceneList=[],i=0;i<e.sceneList.scenes.length;i++)e.getStory().sceneList.push(e.sceneList.scenes[i].vrScene);var t=e.sceneList.scenes[e.sceneSelect.value];e.getStory().sceneList[e.sceneSelect.value].initDict(t.dict),e.getStory().setupScene(e.sceneSelect.value),e.updateShare()}},this.selectElement=function(){if(e.setPanelVisibility(),""!=e.elementSelect.value){var t=e.elementSelect.value.split("_"),i=t[0],n=t[1],s=e.sceneList.scenes[e.sceneSelect.value];if("photo"==i){var o=s.dict.photoObjects[n];e.hfovVRUINumberSlider.set(o.textureDescription.sphereFOV[0]),e.vfovVRUINumberSlider.set(o.textureDescription.sphereFOV[1]),e.xposVRUINumberSlider.set(o.textureDescription.sphereCentre[0]),e.yposVRUINumberSlider.set(o.textureDescription.sphereCentre[1]),e.imageURL.value=o.textureDescription.src,e.isPlane.checked=o.textureDescription.plane,e.isStereo.checked=o.textureDescription.isStereo,e.U_l_x_slider.set(o.textureDescription.U_l[0]),e.U_l_y_slider.set(o.textureDescription.U_l[1]),e.V_l_x_slider.set(o.textureDescription.V_l[0]),e.V_l_y_slider.set(o.textureDescription.V_l[1]),e.U_r_x_slider.set(o.textureDescription.U_r[0]),e.U_r_y_slider.set(o.textureDescription.U_r[1]),e.V_r_x_slider.set(o.textureDescription.V_r[0]),e.V_r_y_slider.set(o.textureDescription.V_r[1]),e.loadImage()}else if("text"==i){var r=s.dict.textObjects[n];e.hfovVRUINumberSlider.set(r.textureDescription.sphereFOV[0]),e.vfovVRUINumberSlider.set(r.textureDescription.sphereFOV[1]),e.xposVRUINumberSlider.set(r.textureDescription.sphereCentre[0]),e.yposVRUINumberSlider.set(r.textureDescription.sphereCentre[1]),e.isPlane.checked=r.textureDescription.plane,e.textMessage.value=r.message,e.fontAlign.value=r.textOptions.align,e.fontFace.value=r.textOptions.fontface,e.fontSize.value=r.textOptions.fontsize,e.borderThickness.value=r.textOptions.borderthickness,e.borderColor.value=r.textOptions.bordercolor,e.backgroundColor.value=r.textOptions.backgroundcolor,e.textColor.value=r.textOptions.textcolor}else if("jump"==i){var c=s.dict.jumpObjects[n];e.hfovVRUINumberSlider.set(c.textureDescription.sphereFOV[0]),e.vfovVRUINumberSlider.set(c.textureDescription.sphereFOV[1]),e.xposVRUINumberSlider.set(c.textureDescription.sphereCentre[0]),e.yposVRUINumberSlider.set(c.textureDescription.sphereCentre[1]),e.isPlane.checked=c.textureDescription.plane,e.jumpTo.value=c.jumpTo,e.jumpText.value=c.jumpText,e.fontAlign.value=c.textOptions.align,e.fontFace.value=c.textOptions.fontface,e.fontSize.value=c.textOptions.fontsize,e.borderThickness.value=c.textOptions.borderthickness,e.borderColor.value=c.textOptions.bordercolor,e.backgroundColor.value=c.textOptions.backgroundcolor,e.textColor.value=c.textOptions.textcolor}}},this.sceneSelectChange=function(){e.populateGUIFromSceneDict(e.sceneSelect.value),e.selectElement()},this.addScene=function(){e.sceneList.addScene(),e.updateSceneListDropdown(),e.populateGUIFromSceneDict(e.sceneSelect.length-1)},this.removeScene=function(){e.sceneList.removeScene(),e.updateSceneListDropdown()},this.stackerEditQuick=function(){e.accordionStacker.totalHide("mode_pick",!0),e.accordionStacker.totalHide("manage_scenes",!0),e.accordionStacker.totalHide("manage_scene_objects",!0),e.accordionStacker.totalHide("setup_scene_object",!1),e.accordionStacker.totalHide("preview_dummy",!1),e.accordionStacker.totalHide("export",!1),e.accordionStacker.showNamed("setup_scene_object"),document.getElementById("preview_box").hidden=!1},this.stackerEditFull=function(){e.accordionStacker.totalHide("mode_pick",!0),e.accordionStacker.totalHide("manage_scenes",!1),e.accordionStacker.totalHide("manage_scene_objects",!1),e.accordionStacker.totalHide("setup_scene_object",!1),e.accordionStacker.totalHide("preview_dummy",!1),e.accordionStacker.totalHide("export",!1),e.accordionStacker.showNamed("manage_scenes"),document.getElementById("preview_box").hidden=!1},this.stackerInit=function(){e.accordionStacker.totalHide("manage_scenes",!0),e.accordionStacker.totalHide("manage_scene_objects",!0),e.accordionStacker.totalHide("setup_scene_object",!0),e.accordionStacker.totalHide("preview_dummy",!0),e.accordionStacker.totalHide("export",!0),document.getElementById("preview_box").hidden=!0},this.tryModeOneImage=function(){if(""!=e.oneImage.value){e.oneImageMode="single";var t=e.oneImage.value;-1!=t.indexOf("flickr.com/photos")?a(t,e.loadModeOneImage):e.loadModeOneImage(t)}},this.tryMode360Image=function(){if(""!=e.oneImage.value){e.oneImageMode="360";var t=e.oneImage.value;-1!=t.indexOf("flickr.com/photos")?a(t,e.loadModeOneImage):e.loadModeOneImage(t)}},this.tryModeStereoImage=function(){if(""!=e.oneImage.value){e.oneImageMode="stereo";var t=e.oneImage.value;-1!=t.indexOf("flickr.com/photos")?a(t,e.loadModeOneImage):e.loadModeOneImage(t)}},this.loadModeOneImage=function(t){var i=e.sceneList.scenes[e.sceneSelect.value];i.addPhoto(),i.dict.photoObjects[0].textureDescription.src=t,"360"==e.oneImageMode?i.dict.photoObjects[0].textureDescription.sphereFOV=[360,180]:"stereo"==e.oneImageMode&&(i.dict.photoObjects[0].textureDescription.isStereo=!0),e.populateGUIFromSceneDict(e.sceneSelect.value),e.elementSelect.value="photo_"+(i.dict.photoObjects.length-1),e.selectElement(),e.stackerEditQuick()},this.tryModeNewStory=function(){e.stackerEditFull()},this.tryModeExistingStory=function(){if(""!=e.existingStory.value){var t=e.existingStory.value,i=new c,n=i.init(t);null!=n&&(e.sceneList.scenes=n,e.sceneList.sceneIdx=0,e.updateSceneListDropdown(),e.populateGUIFromSceneDict(0),e.stackerEditFull())}},this.updateShare=function(){var t=e.getStory().getShareCodes(),i=t[0],n=t[1];if(e.getStory().isSinglePhotoStory()){document.getElementById("singleShare").hidden=!1;var s="https://twitter.com/intent/tweet?text="+encodeURIComponent("Check out my #vrEmbed ")+i,o="https://www.facebook.com/sharer/sharer.php?u="+i,r="https://plus.google.com/share?url="+i,c="http://www.reddit.com/submit?url="+i;document.getElementById("shareURL").href=decodeURIComponent(i),document.getElementById("shareTwitter").href=s,document.getElementById("shareFacebook").href=o,document.getElementById("shareGplus").href=r,document.getElementById("shareReddit").href=c}else document.getElementById("singleShare").hidden=!0;document.getElementById("shareEmbedCode").value=n},this.downloadURI=function(e,t){var i=document.createElement("a");i.download=t,i.href=e,i.click()},this.exportEquirectangular=function(){var t=e.getStory().createImageFromSphereTexture();e.downloadURI(t,"exportEquirectangularTex.png")},this.initObjectPanel=function(){this.imageURL=document.getElementById("imageURL"),this.imagePreviewCanvas=document.getElementById("imagePreviewCanvas");var t=e.imagePreviewCanvas.getContext("2d");t.canvas.width=1024,t.canvas.height=1024,this.imagePreview=new Image,this.imageURL.onchange=this.loadImage,this.imageURL.value="",this.isPlane=document.getElementById("isPlane"),this.isStereo=document.getElementById("isStereo"),this.isPlane.onchange=this.inputStateChange,this.isStereo.onchange=this.inputStateChange,this.U_l_x_slider=new s,this.U_l_x_slider.init(document.getElementById("U_l_x"),document.getElementById("U_l_x_t"),0,this.inputStateChange),this.U_l_y_slider=new s,this.U_l_y_slider.init(document.getElementById("U_l_y"),document.getElementById("U_l_y_t"),0,this.inputStateChange),this.V_l_x_slider=new s,this.V_l_x_slider.init(document.getElementById("V_l_x"),document.getElementById("V_l_x_t"),0,this.inputStateChange),this.V_l_y_slider=new s,this.V_l_y_slider.init(document.getElementById("V_l_y"),document.getElementById("V_l_y_t"),0,this.inputStateChange),this.U_r_x_slider=new s,this.U_r_x_slider.init(document.getElementById("U_r_x"),document.getElementById("U_r_x_t"),0,this.inputStateChange),this.U_r_y_slider=new s,this.U_r_y_slider.init(document.getElementById("U_r_y"),document.getElementById("U_r_y_t"),0,this.inputStateChange),this.V_r_x_slider=new s,this.V_r_x_slider.init(document.getElementById("V_r_x"),document.getElementById("V_r_x_t"),0,this.inputStateChange),this.V_r_y_slider=new s,this.V_r_y_slider.init(document.getElementById("V_r_y"),document.getElementById("V_r_y_t"),0,this.inputStateChange);var i=document.getElementById("loadImage");i.onclick=this.loadImage,this.hfovVRUINumberSlider=new s,this.hfovVRUINumberSlider.init(document.getElementById("hfov"),document.getElementById("hfov_t"),360,this.inputStateChange),this.vfovVRUINumberSlider=new s,this.vfovVRUINumberSlider.init(document.getElementById("vfov"),document.getElementById("vfov_t"),180,this.inputStateChange),this.xposVRUINumberSlider=new s,this.xposVRUINumberSlider.init(document.getElementById("xpos"),document.getElementById("xpos_t"),0,this.inputStateChange),this.yposVRUINumberSlider=new s,this.yposVRUINumberSlider.init(document.getElementById("ypos"),document.getElementById("ypos_t"),0,this.inputStateChange),this.textMessage=document.getElementById("textMessage"),this.textMessage.onchange=this.inputStateChange,this.jumpTo=document.getElementById("jumpTo"),this.jumpTo.onchange=this.inputStateChange,this.jumpText=document.getElementById("jumpText"),this.jumpText.onchange=this.inputStateChange,this.fontAlign=document.getElementById("fontAlign"),this.fontAlign.onchange=this.inputStateChange,this.fontFace=document.getElementById("fontFace"),this.fontFace.onchange=this.inputStateChange,this.fontSize=document.getElementById("fontSize"),this.fontSize.onchange=this.inputStateChange,this.borderThickness=document.getElementById("borderThickness"),this.borderThickness.onchange=this.inputStateChange,this.borderColor=document.getElementById("borderColor"),this.borderColor.onchange=this.inputStateChange,this.backgroundColor=document.getElementById("backgroundColor"),this.backgroundColor.onchange=this.inputStateChange,this.textColor=document.getElementById("textColor"),this.textColor.onchange=this.inputStateChange},this.init=function(e){this.storyManager=e,this.sceneSelect=document.getElementById("sceneSelect"),this.sceneName=document.getElementById("sceneName"),this.elementSelect=document.getElementById("elementSelect");var t=document.getElementById("addScene");t.onclick=this.addScene;var i=document.getElementById("removeScene");i.onclick=this.removeScene,this.sceneSelect.onchange=this.sceneSelectChange,this.sceneName.onchange=this.pushFromGUIToDict,this.elementSelect.onchange=this.selectElement;var n=document.getElementById("addImage"),s=document.getElementById("addText"),r=document.getElementById("addJump"),c=document.getElementById("removeElement");n.onclick=this.addImage,s.onclick=this.addText,r.onclick=this.addJump,c.onclick=this.removeElement,this.oneImage=document.getElementById("oneImage"),this.modeOneImage=document.getElementById("modeOneImage"),this.mode360Image=document.getElementById("mode360Image"),this.modeStereoImage=document.getElementById("modeStereoImage"),this.modeNewStory=document.getElementById("modeNewStory"),this.existingStory=document.getElementById("existingStory"),this.modeExistingStory=document.getElementById("modeExistingStory"),modeOneImage.onclick=this.tryModeOneImage,mode360Image.onclick=this.tryMode360Image,modeStereoImage.onclick=this.tryModeStereoImage,modeNewStory.onclick=this.tryModeNewStory,modeExistingStory.onclick=this.tryModeExistingStory,this.oneImage.value="http://vrembed.org/src/assets/vrEmbedLogo.png",this.exportEquirectangularButton=document.getElementById("exportEquirectangularButton"),this.exportEquirectangularButton.onclick=this.exportEquirectangular,this.initObjectPanel(),this.sceneList.init(),this.updateSceneListDropdown(),this.sceneSelect.value=0,this.sceneSelectChange(),this.setPanelVisibility(),this.accordionStacker=new o,this.accordionStacker.add("mode_pick"),this.accordionStacker.add("manage_scenes"),this.accordionStacker.add("manage_scene_objects"),this.accordionStacker.add("setup_scene_object"),this.accordionStacker.add("preview_dummy"),this.accordionStacker.add("export"),this.accordionStacker.showNamed("mode_pick"),this.stackerInit()}},t.exports=VRCreateUI},{"./VRScene.js":3,"./VRSceneDict.js":4,"./VRStoryDict.js":6,"./VRUIAccordionStacker.js":11,"./VRUINumberSlider.js":12,"./VRUISceneList.js":13}],2:[function(e,t,i){var n=e("./VRTextureDescription.js"),s=e("./VRTextOptions.js");VRJump=function(){this.jumpElm=null,this.textureDescription=null,this.textOptions=null,this.jumpTo=null,this.jumpText=null,this.init=function(e){this.jumpElm=e,this.jumpElm.setAttribute("hidden",!0),this.textureDescription=new n,this.textureDescription.setSphereParamsFromString(this.jumpElm.getAttribute("sphereParams")),this.jumpTo=this.jumpElm.getAttribute("jumpTo"),""==this.jumpElm.innerHTML?this.jumpText=this.jumpTo:this.jumpText=this.jumpElm.innerHTML,this.textOptions=new s,this.textOptions.init(this.jumpElm)},this.initDict=function(e){this.textureDescription=new n,this.textureDescription.initDict(e.textureDescription),this.jumpTo=e.jumpTo,this.jumpText=e.jumpText,this.textOptions=new s,this.textOptions.initDict(e.textOptions)},this.getJumpElement=function(){var e=document.createElement("jump");return e.setAttribute("sphereParams",this.textureDescription.getSphereParamsString()),e.setAttribute("jumpTo",this.jumpTo),e.innerHTML=this.jumpText,this.textOptions.setElement(e),e}},t.exports=VRJump},{"./VRTextOptions.js":8,"./VRTextureDescription.js":9}],3:[function(e,t,n){var s=e("./VRScenePhoto.js"),o=e("./VRText.js"),r=e("./VRJump.js");VRScene=function(){this.sceneElement=null,this.photoObjects=[],this.textObjects=[],this.jumpObjects=[],this.oldScroll=null,this.isStereo=!1,this.name="",this.parseChildNode=function(e){if("PHOTO"==e.nodeName){var t=new s;t.init(e),1==t.isStereo()&&(this.isStereo=!0),this.photoObjects.push(t)}else if("TEXT"==e.nodeName){var i=new o;i.init(e),this.textObjects.push(i)}else if("JUMP"==e.nodeName){var n=new r;n.init(e),this.jumpObjects.push(n)}for(var c=e.childNodes,l=0,a=c.length;a>l;++l){var h=c[l];1===h.nodeType&&this.parseChildNode(h)}},this.init=function(e){this.sceneElement=e;var t=e.getAttribute("name");null!=t&&(this.name=t);for(var i=e.childNodes,n=0,s=i.length;s>n;++n){var o=i[n];1===o.nodeType&&this.parseChildNode(o)}},this.initDict=function(e){this.photoObjects=[],this.textObjects=[],this.jumpObjects=[];for(var t=0,i=e.photoObjects.length;i>t;++t){var n=new s;n.initDict(e.photoObjects[t]),this.photoObjects.push(n)}for(var t=0,i=e.textObjects.length;i>t;++t){var c=new o;c.initDict(e.textObjects[t]),this.textObjects.push(c)}for(var t=0,i=e.jumpObjects.length;i>t;++t){var l=new r;l.initDict(e.jumpObjects[t]),this.jumpObjects.push(l)}this.name=e.name},this.initVrEmbedPhoto=function(e){var t=new s;t.init(e),1==t.isStereo()&&(this.isStereo=!0),this.photoObjects.push(t)},this.initFromURLSource=function(e){1==e.isStereo()&&(this.isStereo=!0),this.photoObjects.push(e)},this.getSceneElement=function(){var e=document.createElement("scene");for(""!=this.name&&e.setAttribute("name",this.name),i=0;i<this.photoObjects.length;i++)e.appendChild(this.photoObjects[i].getPhotoElement());for(j=0;j<this.textObjects.length;j++)e.appendChild(this.textObjects[j].getTextElement());for(k=0;k<this.jumpObjects.length;k++)e.appendChild(this.jumpObjects[k].getJumpElement());return e},this.hasJumpNav=function(){return 0!=this.jumpObjects.length}},t.exports=VRScene},{"./VRJump.js":2,"./VRScenePhoto.js":5,"./VRText.js":7}],4:[function(e,t,n){VRSceneDict=function(){this.dict=null,this.vrScene=null,this.init=function(){this.vrScene=new VRScene,this.dict={},this.dict.photoObjects=[],this.dict.textObjects=[],this.dict.jumpObjects=[],this.dict.name=""},this.initFromVrScene=function(e){for(this.vrScene=e,this.dict={},this.dict.name=e.name,this.dict.photoObjects=[],this.dict.textObjects=[],this.dict.jumpObjects=[],i=0;i<e.photoObjects.length;i++)this.dict.photoObjects.push(this.initFromScenePhoto(e.photoObjects[i]));for(i=0;i<e.textObjects.length;i++)this.dict.textObjects.push(this.initFromText(e.textObjects[i]));for(i=0;i<e.jumpObjects.length;i++)this.dict.jumpObjects.push(this.initFromJump(e.jumpObjects[i]))},this.initFromTextureDescription=function(e){var t={};return t.src=e.textureSource,t.metaSource=e.metaSource,t.isStereo=e.isStereo,t.sphereFOV=e.sphereFOV,t.sphereCentre=e.sphereCentre,t.U_l=e.U_l,t.V_l=e.V_l,t.U_r=e.U_r,t.V_r=e.V_r,t.plane=e.plane,t},this.initFromTextOptions=function(e){var t={};return t.align=e.align,t.fontface=e.fontface,t.fontsize=e.fontsize,t.borderThickness=e.borderthickness,t.borderColor=e.bordercolor,t.backgroundColor=e.backgroundcolor,t.textColor=e.textcolor,t},this.initFromScenePhoto=function(e){var t={};return t.textureDescription=this.initFromTextureDescription(e.textureDescription),t},this.initPhoto=function(){var e={};return e.textureDescription={},e.textureDescription.src="http://vrembed.org/src/assets/vrEmbedLogo.png",e.textureDescription.isStereo=!1,e.textureDescription.plane=!1,e.textureDescription.sphereFOV=[60,60],e.textureDescription.sphereCentre=[0,0],e.textureDescription.U_l=[0,0],e.textureDescription.V_l=[1,.5],e.textureDescription.U_r=[0,.5],e.textureDescription.V_r=[1,1],e},this.initFromText=function(e){var t={};return t.textureDescription=this.initFromTextureDescription(e.textureDescription),t.textOptions=this.initFromTextOptions(e.textOptions),t.message=e.message,t},this.initText=function(){var e={};return e.message="Placeholder text",e.textureDescription={},e.textureDescription.src="",e.textureDescription.isStereo=!1,e.textureDescription.plane=!1,e.textureDescription.sphereFOV=[60,40],e.textureDescription.sphereCentre=[0,0],e.textOptions={},e.textOptions.align="center",e.textOptions.fontface="Arial",e.textOptions.fontsize="72",e.textOptions.borderthickness="12",e.textOptions.bordercolor="#FFFFFF",e.textOptions.backgroundcolor="#000000",e.textOptions.textcolor="#FFFFFF",e},this.initFromJump=function(e){var t={};return t.textureDescription=this.initFromTextureDescription(e.textureDescription),t.textOptions=this.initFromTextOptions(e.textOptions),t.jumpTo=e.jumpTo,t.jumpText=e.jumpText,t},this.initJump=function(){var e={};return e.jumpTo="",e.jumpText="Jump text",e.textureDescription={},e.textureDescription.src="",e.textureDescription.isStereo=!1,e.textureDescription.plane=!1,e.textureDescription.sphereFOV=[60,40],e.textureDescription.sphereCentre=[30,-30],e.textOptions={},e.textOptions.align="center",e.textOptions.fontface="Arial",e.textOptions.fontsize="72",e.textOptions.borderthickness="12",e.textOptions.bordercolor="#FFFFFF",e.textOptions.backgroundcolor="#000000",e.textOptions.textcolor="#FFFFFF",e},this.addPhoto=function(){var e=this.initPhoto();this.dict.photoObjects.push(e)},this.removePhoto=function(e){this.dict.photoObjects.splice(e,1)},this.addText=function(){var e=this.initText();this.dict.textObjects.push(e)},this.removeText=function(e){this.dict.textObjects.splice(e,1)},this.addJump=function(){var e=this.initJump();this.dict.jumpObjects.push(e)},this.removeJump=function(e){this.dict.jumpObjects.splice(e,1)}},t.exports=VRSceneDict},{}],5:[function(e,t,i){var n=e("./VRTextureDescription.js");VRScenePhoto=function(){this.scenePhoto=null,this.textureDescription=null,this.parseBoolString=function(e){return void 0==e?!1:"true"==e.toLowerCase()?!0:!1},this.init=function(e){return this.scenePhoto=e,this.textureDescription=new n,this.textureDescription.textureSource=this.scenePhoto.getAttribute("src"),null==this.textureDescription.textureSource?void(this.textureDescription=null):(this.textureDescription.metaSource="",this.textureDescription.isStereo=this.parseBoolString(this.scenePhoto.getAttribute("isStereo")),this.textureDescription.plane=this.parseBoolString(this.scenePhoto.getAttribute("plane")),this.textureDescription.setSphereParamsFromString(this.scenePhoto.getAttribute("sphereParams")),void(this.isStereo()&&this.textureDescription.setTexParamsFromString(this.scenePhoto.getAttribute("texParams"))))},this.initDict=function(e){this.textureDescription=new n,this.textureDescription.initDict(e.textureDescription)},this.initFromURL=function(e){return this.textureDescription=new n,this.textureDescription.textureSource=e.src,void 0==this.textureDescription.textureSource?void(this.textureDescription=null):(void 0!=e.metaSrc?this.textureDescription.metaSource=e.metaSrc:this.textureDescription.metaSource="",this.textureDescription.isStereo=this.parseBoolString(e.isStereo),this.textureDescription.plane=this.parseBoolString(e.plane),void 0!=e.sphereParams?this.textureDescription.setSphereParamsFromString(e.sphereParams):this.textureDescription.setSphereParamsFromString("360,180,0,0"),void(void 0!=e.texParams?this.textureDescription.setTexParamsFromString(e.texParams):this.textureDescription.setTexParamsFromString("0,0,1,1,0,0,1,1")))},this.populateElementCommon=function(e){return e.setAttribute("src",this.textureDescription.getAbsoluteTexturePath()),
e.setAttribute("sphereParams",this.textureDescription.getSphereParamsString()),0==this.isPlane()?e.setAttribute("plane","false"):e.setAttribute("plane","true"),0==this.isStereo()?void e.setAttribute("isStereo","false"):(e.setAttribute("isStereo","true"),void e.setAttribute("texParams",this.textureDescription.getTexParamsString()))},this.isStereo=function(){return this.textureDescription.isStereo},this.isPlane=function(){return this.textureDescription.plane},this.getPhotoElement=function(){var e=document.createElement("photo");return this.populateElementCommon(e),e},this.getSinglePhotoVrEmbedElement=function(){var e=document.createElement("a");return e.setAttribute("class","vrEmbedPhoto"),this.populateElementCommon(e),e},this.getSinglePhotoURLParams=function(){var e="?";return e+="src="+this.textureDescription.getAbsoluteTexturePath(),e+="&sphereParams="+this.textureDescription.getSphereParamsString(),0==this.isStereo()?e+="&isStereo=false":(e+="&isStereo=true",e+="&texParams="+this.textureDescription.getTexParamsString()),e+=0==this.isPlane()?"&plane=false":"&plane=true"}},t.exports=VRScenePhoto},{"./VRTextureDescription.js":9}],6:[function(e,t,i){var n=e("./VRSceneDict.js");e("./VRUISceneList.js");VRStoryDict=function(){this.init=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.getElementsByTagName("story");if(0==i.length)return null;var s=[];for(storyit=0;storyit<i.length;storyit++)for(var o=i[storyit],r=o.childNodes,c=0,l=r.length;l>c;++c){var a=r[c];if(1===a.nodeType&&"SCENE"==a.nodeName){var h=new VRScene;h.init(a);var u=new n;u.initFromVrScene(h),s.push(u)}}return t.remove(),s}},t.exports=VRStoryDict},{"./VRSceneDict.js":4,"./VRUISceneList.js":13}],7:[function(e,t,i){var n=e("./VRTextureDescription.js"),s=e("./VRTextOptions.js");VRText=function(){this.sceneText=null,this.textureDescription=null,this.textOptions=null,this.message="",this.parseMessage=function(e){this.message=e},this.init=function(e){this.sceneText=e,this.sceneText.setAttribute("hidden",!0),this.textureDescription=new n,this.textureDescription.setSphereParamsFromString(this.sceneText.getAttribute("sphereParams")),this.parseMessage(this.sceneText.innerHTML),this.textOptions=new s,this.textOptions.init(this.sceneText)},this.initDict=function(e){this.textureDescription=new n,this.textureDescription.initDict(e.textureDescription),this.parseMessage(e.message),this.textOptions=new s,this.textOptions.initDict(e.textOptions)},this.getTextElement=function(){var e=document.createElement("text");return e.setAttribute("sphereParams",this.textureDescription.getSphereParamsString()),e.innerHTML=this.message,this.textOptions.setElement(e),e}},t.exports=VRText},{"./VRTextOptions.js":8,"./VRTextureDescription.js":9}],8:[function(e,t,i){VRTextOptions=function(){this.align=null,this.fontface=null,this.fontsize=null,this.borderThickness=null,this.borderColor=null,this.backgroundColor=null,this.textColor=null,this.init=function(e){this.align=e.getAttribute("align"),this.fontface=e.getAttribute("fontface"),this.fontsize=e.getAttribute("fontsize"),this.borderThickness=e.getAttribute("borderthickness"),this.borderColor=e.getAttribute("bordercolor"),this.backgroundColor=e.getAttribute("backgroundcolor"),this.textColor=e.getAttribute("textcolor")},this.initDict=function(e){this.align=e.align,this.fontface=e.fontface,this.fontsize=e.fontsize,this.borderThickness=e.borderthickness,this.borderColor=e.bordercolor,this.backgroundColor=e.backgroundcolor,this.textColor=e.textcolor},this.setElement=function(e){null!=this.align&&e.setAttribute("align",this.align),null!=this.fontface&&e.setAttribute("fontface",this.fontface),null!=this.fontsize&&e.setAttribute("fontsize",this.fontsize),null!=this.borderThickness&&e.setAttribute("borderthickness",this.borderThickness),null!=this.borderColor&&e.setAttribute("bordercolor",this.borderColor),null!=this.backgroundColor&&e.setAttribute("backgroundcolor",this.backgroundColor),null!=this.textColor&&e.setAttribute("textcolor",this.textColor)}},t.exports=VRTextOptions},{}],9:[function(e,t,i){VRTextureDescription=function(){this.textureSource="",this.metaSource="",this.isStereo=!1,this.sphereFOV=[360,180],this.sphereCentre=[0,0],this.U_l=[0,0],this.V_l=[1,1],this.U_r=[0,0],this.V_r=[1,1],this.plane=!1,this.setSphereParamsFromString=function(e){var t=e.split(",");this.sphereFOV=[t[0].trim(),t[1].trim()],this.sphereCentre=[t[2].trim(),t[3].trim()]},this.setTexParamsFromString=function(e){var t=e.split(",");this.U_l=[t[0].trim(),t[1].trim()],this.V_l=[t[2].trim(),t[3].trim()],this.U_r=[t[4].trim(),t[5].trim()],this.V_r=[t[6].trim(),t[7].trim()]},this.getSphereParamsString=function(){return this.sphereFOV[0]+","+this.sphereFOV[1]+","+this.sphereCentre[0]+","+this.sphereCentre[1]},this.getTexParamsString=function(){return this.U_l[0]+","+this.U_l[1]+","+this.V_l[0]+","+this.V_l[1]+","+this.U_r[0]+","+this.U_r[1]+","+this.V_r[0]+","+this.V_r[1]},this.getAbsoluteTexturePath=function(){var e=document.createElement("a");return e.href=this.textureSource,e.protocol+"//"+e.host+e.pathname+e.search+e.hash},this.initDict=function(e){return this.textureSource=e.src,null==this.textureSource?void(this.textureSource=null):(this.metaSource="",this.isStereo=e.isStereo,this.plane=e.plane,this.sphereFOV=e.sphereFOV,this.sphereCentre=e.sphereCentre,void(this.isStereo&&(this.U_l=e.U_l,this.V_l=e.V_l,this.U_r=e.U_r,this.V_r=e.V_r)))}},t.exports=VRTextureDescription},{}],10:[function(e,t,i){VRUIAccordion=function(){var e=this;this.bar=null,this.button=null,this.container=null,this.shown=!1,this.accordionManager=!1,this.name=null,this.totalHide=function(t){e.container.hidden=t,e.bar.hidden=t},this.show=function(t){e.shown=t,0==t?(e.container.hidden=!0,e.button.innerHTML="+"):(e.container.hidden=!1,e.button.innerHTML="-")},this.toggle=function(){e.accordionManager.toggle(e.name)},this.init=function(e,t){this.name=t,this.accordionManager=e,this.container=document.getElementById(t),this.button=document.getElementById(t+"_button"),this.bar=document.getElementById(t+"_bar"),this.button.onclick=this.toggle,this.show(!1)}},t.exports=VRUIAccordion},{}],11:[function(e,t,n){var s=e("./VRUIAccordion.js");VRUIAccordionStacker=function(){var e=this;this.accordions=[],this.active=null,this.add=function(t){var i=new s;i.init(e,t),e.accordions.push([t,i])},this.showNamed=function(t){for(i=0;i<e.accordions.length;i++)t==e.accordions[i][0]?(e.active=t,e.accordions[i][1].show(!0)):e.accordions[i][1].show(!1)},this.toggle=function(t){e.active!=t&&e.showNamed(t)},this.totalHide=function(t,n){for(i=0;i<e.accordions.length;i++)if(t==e.accordions[i][0])return void e.accordions[i][1].totalHide(n)}},t.exports=VRUIAccordionStacker},{"./VRUIAccordion.js":10}],12:[function(e,t,i){var n=function(){var e=this;this.sliderElement=null,this.textElement=null,this.callback=null,this.sliderMove=function(){e.textElement.value=e.sliderElement.value},this.inputStateChange=function(){e.textElement.value=e.sliderElement.value,e.callback()},this.textChange=function(){return parseFloat(e.textElement.value)<parseFloat(e.sliderElement.min)||parseFloat(e.textElement.value)>parseFloat(e.sliderElement.max)?void(e.textElement.value=e.sliderElement.value):(e.sliderElement.value=e.textElement.value,void e.callback())},this.set=function(t){e.sliderElement.value=t,e.textElement.value=t},this.get=function(){return e.sliderElement.value},this.init=function(e,t,i,n){this.sliderElement=e,this.textElement=t,this.set(i),this.callback=n,this.sliderElement.oninput=this.sliderMove,this.sliderElement.onchange=this.inputStateChange,this.textElement.onchange=this.textChange}};t.exports=n},{}],13:[function(e,t,i){VRUISceneList=function(){this.scenes=[],this.sceneIdx=-1,this.init=function(){this.addScene(),this.sceneIdx=0},this.addScene=function(){var e=new VRSceneDict;e.init(),this.scenes.push(e)},this.getScene=function(e){return this.scenes[e]},this.removeScene=function(e){this.scenes.length>1&&this.scenes.splice(e,1)}},t.exports=VRUISceneList},{}],14:[function(e,t,i){var n=e("./VRCreateUI.js");new n},{"./VRCreateUI.js":1}]},{},[14]);
