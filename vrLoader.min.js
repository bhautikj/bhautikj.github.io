!function t(e,i,r){function n(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var p=i[o]={exports:{}};e[o][0].call(p.exports,function(t){var i=e[o][1][t];return n(i?i:t)},p,p.exports,t,e,i,r)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,r){function n(t){var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}var s=t("./VRSceneDict.js"),o=t("./VRURLParser.js"),a=t("./VRMacroStrings.js");String.prototype.padRight=function(t,e){return this+Array(t-this.length+1).join(e||" ")},String.prototype.contains=function(t){return-1!=this.indexOf(t)};var c=function(t,e){var i=e-t.length,r=(" "+t).slice(1);return i>0&&(r=r.padRight(i," ")),r},p={},h={},g={},m={},d={},f={},x=function(t){var e=null,r=t.split("/");for(i=0;l=r.length,i<l;i++)if(r[i].endsWith("imgur.com")&&i<l-1)return e=r[i+1],""==e?null:"a"==e?i<l-2?(e=r[i+2],[e,"album"]):null:"gallery"==e?i<l-2?(e=r[i+2],[e,"gallery"]):null:(partspl=e.split("."),""==partspl[0]?null:[partspl[0],"image"])},D=function(t,e,i,r){var n="";n+=e,n+=t,n+="?client_id=fe596e6329962dd";var s=new XMLHttpRequest;s.open("GET",n,!0),s.setRequestHeader("Authorization","Client-ID fe596e6329962dd"),s.setRequestHeader("Accept","application/json"),s.send(),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=JSON.parse(s.responseText);i(t,e,r)}}},b=function(t){var e=t.split("/"),i=e.pop(),r=i.split(".");return e.join("/")+"/"+r[0]+"b."+r[1]},O=function(t){if(null==t)return null;for(var e in a)if(t.contains(e))return e;return null},F=function(t){var e={};return 1==t.animated?null:t.height>4096||t.width>4096?null:(e.src=t.link,e.thumb=b(e.src),e.title=t.title,e.description=t.description,e.width=t.width,e.height=t.height,e.attribution="",e.misc=t.views+" views",e.macro=O(t.description),e)},S=function(t,e,i){m[t]=e;var r=(e.data.link,F(e.data)),n={};if(n.images=[r],n.galleryTitle=null,n.galleryDescription=null,n.galleryAttribution=null,n.galleryMisc=null,null!=i&&null!=n){var s=W(n);i(s)}},y=function(t,e){return t in m?void(null!=e&&S(m[t])):void D(t,"https://api.imgur.com/3/image/",S,e)},j=function(t,e,r){d[t]=e;var n=e.data.images,s=e.data.title,o=e.data.description,a=e.data.account_id,c=e.data.views+" views",p={};for(p.galleryTitle=s,p.galleryDescription=o,p.galleryAttribution=a,p.galleryMisc=c,p.images=[],i=0;l=n.length,i<l;i++){var u=n[i],h=F(u);null!=h&&p.images.push(h)}if(null!=r&&p!=[]){var g=W(p);r(g)}},R=function(t,e){return t in d?void(null!=e&&j(d[t])):void D(t,"https://api.imgur.com/3/album/",j,e)},V=function(t,e,r){f[t]=e;var n=e.data.images,s=e.data.title,o=e.data.description,a=e.data.account_id,c=e.data.views+" views",p={};for(p.galleryTitle=s,p.galleryDescription=o,p.galleryAttribution=a,p.galleryMisc=c,p.images=[],i=0;l=n.length,i<l;i++){var u=n[i],h=F(u);null!=h&&p.images.push(h)}if(null!=r&&p!=[]){var g=W(p);r(g)}},L=function(t,e){return t in f?void(null!=e&&V(f[t])):void D(t,"https://api.imgur.com/3/gallery/album/",V,e)},_=function(t,e,i,r){var n="";n+="https://api.flickr.com/services/rest/?",n+="&api_key=c074e17f92ea52a8d9422928352b0053",n+="&format=json",n+="&nojsoncallback=1",n+=e;var s=new XMLHttpRequest;s.open("GET",n,!0),s.send(),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=JSON.parse(s.responseText);i(t,e,r)}}},T=function(t){var e=t.split("/"),r=e.length;for(i=0;i<r&&!e[0].contains("flickr.com");i++)e.shift();return e==[]||"sets"!=e[3]&&"albums"!=e[3]?null:e[4]},U=function(t,e,r){var n=e.sizes.size,s=0,o=0,a="";for(i=0;i<n.length;i++){var c=parseInt(n[i].width);2048>=c&&c>o&&(o=c,s=i),n[i].source.endsWith("_m.jpg")&&(a=n[i].source)}""==a&&(a=n[s].source);var l={};l.photo_id=t,l.thumb=a,l.img=n[s].source,l.width=parseInt(n[s].width),l.height=parseInt(n[s].height),p[t]=l,r(p[t])},w=function(t,e){return null==t?!1:t in p?void e(p[t]):void _(t,"&method=flickr.photos.getSizes&photo_id="+t,U,e)},P=function(t,e,r){var s=e.photo.title._content,o=e.photo.description._content,a=e.photo.tags.tag,c=null;for(i=0;i<a.length;i++){var l=O(a[i].raw);null!=l&&(c=l)}var p={};p.photo_id=t,p.title=s,p.description=n(o),p.macro=c,h[t]=p,r(h[t])},I=function(t,e){return null==t?!1:t in h?void e(h[t]):void _(t,"&method=flickr.photos.getInfo&photo_id="+t,P,e)},C=function(t,e,r){var n=e.photoset.photo,s={};s.galleryTitle="",void 0!=e.photoset.title&&(s.galleryTitle=e.photoset.title),s.galleryDescription="",void 0!=e.photoset.ownername&&(s.galleryAttribution=e.photoset.ownername),s.galleryMisc="";var o=[];for(i=0;l=n.length,i<l;i++)o.push(n[i].id);g[t]=[s,o],r([s,o])},E=function(t,e){return null==t?!1:t in g?void e(g[t]):void _(t,"&method=flickr.photosets.getPhotos&photoset_id="+t,C,e)},M={},k=null,A=function(t,e,r){var n={},s=null,o=null;for(i=0;i<e.length;i++)e[i].photo_id==t&&(s=e[i]);for(i=0;i<r.length;i++)r[i].photo_id==t&&(o=r[i]);return null==s||null==o?null:(n.src=s.img,n.thumb=s.thumb,n.title=o.title,n.description=o.description,n.width=s.width,n.height=s.height,n.attribution="",n.misc="",n.macro=o.macro,n)},q=function(){var t=M.dt,e=M.photoIds.length;for(t.images=[],z=0;z<e;z++){var i=M.photoIds[z],r=A(i,M.imageURLs,M.imageInfos);null!=r&&t.images.push(r)}var n=W(t);null!=k&&k(n)},G=function(t){M.imageURLs.push(t),M.imageURLs.length==M.targetSize&&M.imageInfos.length==M.targetSize&&q()},H=function(t){M.imageInfos.push(t),M.imageURLs.length==M.targetSize&&M.imageInfos.length==M.targetSize&&q()},N=function(t){var e=t[0],r=t[1];for(M={},M.targetSize=r.length,M.dt=e,M.photoIds=r,M.imageURLs=[],M.imageInfos=[],i=0;i<r.length;i++)w(r[i],G),I(r[i],H)},B=70,J=function(t,e,i){return null==i?[t,e]:("vrEmbed:macro=360"==i?(t.textureDescription.sphereFOV=[360,180],t.textureDescription.plane=!1):"vrEmbed:macro=3dparallel"==i?(e.width=.5*e.width,t.textureDescription.sphereFOV=[B,B*e.height/e.width],t.textureDescription.isStereo=!0,t.textureDescription.U_l=[0,0],t.textureDescription.V_l=[.5,1],t.textureDescription.U_r=[.5,0],t.textureDescription.V_r=[1,1]):"vrEmbed:macro=3dcrosseye"==i?(e.width=.5*e.width,t.textureDescription.sphereFOV=[B,B*e.height/e.width],t.textureDescription.isStereo=!0,t.textureDescription.U_l=[.5,0],t.textureDescription.V_l=[1,1],t.textureDescription.U_r=[0,0],t.textureDescription.V_r=[.5,1]):"vrEmbed:macro=3d360"==i&&(t.textureDescription.sphereFOV=[360,180],t.textureDescription.plane=!1,t.textureDescription.isStereo=!0,t.textureDescription.U_l=[0,0],t.textureDescription.V_l=[1,.5],t.textureDescription.U_r=[0,.5],t.textureDescription.V_r=[1,1]),[t,e])},W=function(t){var e=[],i=16;for(j=0;l=t.images.length,j<l;j++){var r=Math.floor(j/i),n=new s;n.init(),n.dict.name="image_"+j;var o=t.images[j],a=n.initPhoto();a.textureDescription.src=o.src,a.textureDescription.sphereFOV=[B,B*o.height/o.width],a.textureDescription.plane=!0;var p=J(a,o,o.macro),h=p[0],g=p[1];n.dict.photoObjects.push(h);var m="",d=45;null!=g.title&&(m+="Title: "+g.title+" \n"),null!=g.description&&(m+="Description: "+g.description+" \n");var f="";""!=g.misc&&(f+=g.misc),""!=g.attribution&&(f+=" "+g.attribution),m+=c(f,d)+" \n";var x=.2;if(""!=m){var D=n.initText();D.message=m,D.textOptions.borderthickness=0,D.textOptions.align="left",D.textOptions.fontface="Courier",D.textOptions.fontsize=36,D.textureDescription.sphereFOV=[B/1.5,20],D.textureDescription.sphereCentre=[B,0],D.textureDescription.plane=!0,D.textureDescription.planeOffset=[0,0],n.dict.textObjects.push(D)}var b=n.initDecal();b.imgsrc="http://vrembed.org/src/assets/vrEmbedLogo.png",b.textureDescription.sphereFOV=[2*B*x,2*B*x],b.textureDescription.sphereCentre=[0,-90],b.textureDescription.plane=!1,b.textureDescription.planeOffset=[0,0],n.dict.decalObjects.push(b);var O=-(.5+x)*(B*g.height/g.width);if(j>0){var F=n.initDecal(),S=t.images[j-1];F.jumpTo="image_"+(j-1),F.imgsrc=S.thumb,F.textureDescription.sphereFOV=[B*x,x*B*S.height/S.width],F.textureDescription.sphereCentre=[0,0],F.textureDescription.plane=!0,F.textureDescription.planeOffset=[-(.5-.5*x)*B,O],n.dict.decalObjects.push(F)}if(j<t.images.length-1){var F=n.initDecal(),S=t.images[j+1];F.jumpTo="image_"+(j+1),F.imgsrc=S.thumb,F.textureDescription.sphereFOV=[B*x,x*B*S.height/S.width],F.textureDescription.sphereCentre=[0,0],F.textureDescription.plane=!0,F.textureDescription.planeOffset=[(.5-.5*x)*B,O],n.dict.decalObjects.push(F)}var y=n.initDecal();y.jumpTo="index_"+r,y.imgsrc="http://vrembed.org/src/assets/gallery.png",y.textureDescription.sphereFOV=[B*x,B*x],y.textureDescription.sphereCentre=[0,0],y.textureDescription.plane=!0,y.textureDescription.planeOffset=[0,O],n.dict.decalObjects.push(y),e.push(n)}var j,R,V,L=t.images.length,_=i,T=Math.ceil(L/i),U=0,w=0;for(j=0,R=L;R>j;j+=_){V=t.images.slice(j,j+_);var P=0,n=new s;n.init(),n.dict.name="index_"+U;var I=30;for(v=0;v<4;v++){var C=-30;for(u=0;u<4&&!(w>=L);u++){var F=n.initDecal(),S=V[P];F.jumpTo="image_"+w,F.imgsrc=S.thumb,F.textureDescription.sphereFOV=[18,18],F.textureDescription.sphereCentre=[0,0],F.textureDescription.plane=!0,F.textureDescription.planeOffset=[C,I],n.dict.decalObjects.push(F),P+=1,w+=1,C+=20}I+=-20}if(U>0){var E=n.initDecal();E.jumpTo="index_"+(U-1),E.imgsrc="http://vrembed.org/src/assets/prevArrow.png",E.textureDescription.sphereFOV=[15,15],E.textureDescription.sphereCentre=[0,0],E.textureDescription.plane=!0,E.textureDescription.planeOffset=[-20,-60],n.dict.decalObjects.push(E)}if(T-1>U){var M=n.initDecal();M.jumpTo="index_"+(U+1),M.imgsrc="http://vrembed.org/src/assets/nextArrow.png",M.textureDescription.sphereFOV=[15,15],M.textureDescription.sphereCentre=[0,0],M.textureDescription.plane=!0,M.textureDescription.planeOffset=[20,-60],n.dict.decalObjects.push(M)}var b=n.initDecal();b.imgsrc="http://vrembed.org/src/assets/vrEmbedLogo.png",b.textureDescription.sphereFOV=[2*B*x,2*B*x],b.textureDescription.sphereCentre=[0,-90],b.textureDescription.plane=!1,b.textureDescription.planeOffset=[0,0],n.dict.decalObjects.push(b);var k=t.galleryTitle+" \n";k+=t.galleryDescription+" \n",k+="by "+t.galleryAttribution+" \n",k+=t.galleryMisc+" \n";var D=n.initText();D.message=k,D.textOptions.borderthickness=0,D.textOptions.align="left",D.textOptions.fontface="Courier",D.textOptions.fontsize=36,D.textureDescription.sphereFOV=[B/1.5,20],D.textureDescription.sphereCentre=[B,0],D.textureDescription.plane=!0,D.textureDescription.planeOffset=[0,0],n.dict.textObjects.push(D),e.push(n),U+=1}return e};VRImageLoader=function(){var t=this;this.sceneList=[],this.storyManager=null,this.vrURLParser=new o,this.vrURLParser.init(),this.init=function(t){this.storyManager=t},this.hasURLParams=function(){return this.vrURLParser.isEditor},this.getURLParameters=function(){return this.vrURLParser.params},this.isGalleryURL=function(){return"gallery"in this.getURLParameters()},this.isImageURL=function(){return"src"in this.getURLParameters()},this.getImages=function(e){t.getImagesCallback(e,this.buildFromImageList)},this.getImagesCallback=function(e,i){null!=t.getStory()&&t.getStory().setGallerySrc(e);var r=x(e);null!=r&&("image"==r[1]?y(r[0],i):"album"==r[1]?R(r[0],i):"gallery"==r[1]&&L(r[0],i));var n=T(e);null!=n&&(E(n,N),k=this.buildFromImageList),t.getStory().setLoading(!0)},this.parseBoolString=function(t){return void 0==t?!1:"true"==t.toLowerCase()?!0:!1},this.parsePlaneOffsetParamsFromString=function(t){if(void 0!=t){var e=t.split(",");return[parseFloat(e[0].trim()),parseFloat(e[1].trim())]}},this.getSphereParamsFromString=function(t){var e=t.split(",");return[[parseFloat(e[0].trim()),parseFloat(e[1].trim())],[parseFloat(e[2].trim()),parseFloat(e[3].trim())]]},this.getTexParamsFromString=function(t){var e=t.split(",");return[[parseFloat(e[0].trim()),parseFloat(e[1].trim())],[parseFloat(e[2].trim()),parseFloat(e[3].trim())],[parseFloat(e[4].trim()),parseFloat(e[5].trim())],[parseFloat(e[6].trim()),parseFloat(e[7].trim())]]},this.buildFromImageURLParams=function(t){var e=new Image;e.onload=this.buildSingle,e.src=t.src},this.buildSingle=function(){var e=t.getURLParameters(),i=new s;i.init();var r=i.initPhoto();if(r.name="unit",r.textureDescription.src=e.src,void 0!=e.metaSrc?r.textureDescription.metaSource=e.metaSrc:r.textureDescription.metaSource="",r.textureDescription.isStereo=t.parseBoolString(e.isStereo),r.textureDescription.plane=t.parseBoolString(e.plane),r.textureDescription.planeOffset=t.parsePlaneOffsetParamsFromString(e.planeOffset),void 0!=e.sphereParams){var n=t.getSphereParamsFromString(e.sphereParams);r.textureDescription.sphereFOV=n[0],r.textureDescription.sphereCentre=n[1]}if(void 0!=e.texParams){var o=t.getTexParamsFromString(e.texParams);r.textureDescription.U_l=o[0],r.textureDescription.V_l=o[1],r.textureDescription.U_r=o[2],r.textureDescription.V_r=o[3]}i.dict.photoObjects.push(r);var a=[];a.push(i),t.pushFromDictToRender(a),t.getStory().setLoading(!1)},this.buildFromImageList=function(e){t.pushFromDictToRender(e),t.getStory().setLoading(!1)},this.getStory=function(){return null==t.storyManager?null:t.storyManager.storyList!=[]?t.storyManager.storyList[0]:null},this.pushFromDictToRender=function(e){if(null!=t.getStory()){for(t.getStory().sceneList=[],t.getStory().namedSceneMap={},i=0;i<e.length;i++){var r=e[i];r.vrScene.initDict(e[i].dict),t.getStory().sceneList.push(r.vrScene),t.getStory().namedSceneMap[r.vrScene.name]=i}t.getStory().setupScene(0)}}};var X=function(){function t(){var t=new VRImageLoader;return t}var e;return{getInstance:function(){return e||(e=t()),e}}}();e.exports=X.getInstance()},{"./VRMacroStrings.js":2,"./VRSceneDict.js":3,"./VRURLParser.js":4}],2:[function(t,e,i){VRMacroStrings={"vrEmbed:macro=360":0,"vrEmbed:macro=3dparallel":1,"vrEmbed:macro=3dcrosseye":2,"vrEmbed:macro=3d360":3},e.exports=VRMacroStrings},{}],3:[function(t,e,r){VRSceneDict=function(){this.dict=null,this.vrScene=null,this.init=function(){this.vrScene=new VRScene,this.dict={},this.dict.photoObjects=[],this.dict.textObjects=[],this.dict.decalObjects=[],this.dict.name=""},this.initFromVrScene=function(t){for(this.vrScene=t,this.dict={},this.dict.name=t.name,this.dict.photoObjects=[],this.dict.textObjects=[],this.dict.decalObjects=[],i=0;i<t.photoObjects.length;i++)this.dict.photoObjects.push(this.initFromScenePhoto(t.photoObjects[i]));for(i=0;i<t.textObjects.length;i++)this.dict.textObjects.push(this.initFromText(t.textObjects[i]));for(i=0;i<t.decalObjects.length;i++)this.dict.decalObjects.push(this.initFromDecal(t.decalObjects[i]))},this.initFromTextureDescription=function(t){var e={};return e.src=t.textureSource,e.metaSource=t.metaSource,e.isStereo=t.isStereo,e.sphereFOV=t.sphereFOV,e.sphereCentre=t.sphereCentre,e.planeOffset=t.planeOffset,e.U_l=t.U_l,e.V_l=t.V_l,e.U_r=t.U_r,e.V_r=t.V_r,e.plane=t.plane,e},this.initFromTextOptions=function(t){var e={};return e.align=t.align,e.fontface=t.fontface,e.fontsize=t.fontsize,e.borderThickness=t.borderthickness,e.borderColor=t.bordercolor,e.backgroundColor=t.backgroundcolor,e.textColor=t.textcolor,e},this.initFromScenePhoto=function(t){var e={};return e.textureDescription=this.initFromTextureDescription(t.textureDescription),e},this.initPhoto=function(){var t={};return t.textureDescription={},t.textureDescription.src="http://vrembed.org/src/assets/vrEmbedLogo.png",t.textureDescription.isStereo=!1,t.textureDescription.plane=!1,t.textureDescription.sphereFOV=[60,60],t.textureDescription.sphereCentre=[0,0],t.textureDescription.planeOffset=[0,0],t.textureDescription.U_l=[0,0],t.textureDescription.V_l=[.5,1],t.textureDescription.U_r=[.5,0],t.textureDescription.V_r=[1,1],t},this.initFromText=function(t){var e={};return e.textureDescription=this.initFromTextureDescription(t.textureDescription),e.textOptions=this.initFromTextOptions(t.textOptions),e.message=t.message,e.jumpTo=t.jumpTo,e},this.initText=function(){var t={};return t.message="Placeholder text",t.jumpTo="",t.textureDescription={},t.textureDescription.src="",t.textureDescription.isStereo=!1,t.textureDescription.plane=!1,t.textureDescription.sphereFOV=[60,40],t.textureDescription.sphereCentre=[0,0],t.textureDescription.planeOffset=[0,0],t.textOptions={},t.textOptions.align="center",t.textOptions.fontface="Arial",t.textOptions.fontsize="72",t.textOptions.borderthickness="12",t.textOptions.bordercolor="#FFFFFF",t.textOptions.backgroundcolor="#000000",t.textOptions.textcolor="#FFFFFF",t},this.initFromDecal=function(t){var e={};return e.textureDescription=this.initFromTextureDescription(t.textureDescription),t.imgsrc=t.imgsrc,t.jumpTo=t.jumpTo,text},this.initDecal=function(){var t={};return t.imgsrc="http://vrembed.org/src/assets/vrEmbedLogo.png",t.jumpTo="",t.textureDescription={},t.textureDescription.src="",t.textureDescription.isStereo=!1,t.textureDescription.plane=!0,t.textureDescription.sphereFOV=[30,30],t.textureDescription.sphereCentre=[0,0],t.textureDescription.planeOffset=[0,0],t},this.addDecal=function(){var t=this.initDecal();this.dict.decalObjects.push(t)},this.removeDecal=function(t){this.dict.decalObjects.splice(t,1)},this.addPhoto=function(){var t=this.initPhoto();this.dict.photoObjects.push(t)},this.removePhoto=function(t){this.dict.photoObjects.splice(t,1)},this.addText=function(){var t=this.initText();this.dict.textObjects.push(t)},this.removeText=function(t){this.dict.textObjects.splice(t,1)}},e.exports=VRSceneDict},{}],4:[function(t,e,i){function r(){var t=window.location.search.substr(1);return null!=t&&""!=t?n(t):{}}function n(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");e[n[0]]=decodeURIComponent(n[1])}return e}VRURLParser=function(){this.isEditor=!1,this.params=[],this.scenePhoto=null,this.parseURL=function(){this.params=r()},this.init=function(){var t=document.getElementsByTagName("vrEditor");this.parseURL();var e=0;for(var i in this.params)e+=1;0!=t.length&&0!=e&&(this.isEditor=!0)}},e.exports=VRURLParser},{}],5:[function(t,e,i){var r=t("./VRImageLoader.js");r.init(vrEmbed),r.hasURLParams()&&(r.isGalleryURL()?(vrEmbed.clearPage(),vrEmbed.initFullpage(),r.getImages(r.getURLParameters().gallery)):r.isImageURL()&&(vrEmbed.clearPage(),vrEmbed.initFullpage(),r.buildFromImageURLParams(r.getURLParameters()))),e.exports=VRImageLoader},{"./VRImageLoader.js":1}]},{},[5]);
